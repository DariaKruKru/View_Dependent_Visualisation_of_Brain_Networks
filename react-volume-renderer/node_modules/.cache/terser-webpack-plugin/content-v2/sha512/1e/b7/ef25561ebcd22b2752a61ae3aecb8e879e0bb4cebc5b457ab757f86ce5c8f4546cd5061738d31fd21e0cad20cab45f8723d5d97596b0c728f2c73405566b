{"code":"!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t(require(\"three\"),require(\"react\"),require(\"chroma-js\")):\"function\"==typeof define&&define.amd?define(\"react-volume-renderer\",[\"three\",\"React\",\"chroma-js\"],t):\"object\"==typeof exports?exports[\"react-volume-renderer\"]=t(require(\"three\"),require(\"react\"),require(\"chroma-js\")):e[\"react-volume-renderer\"]=t(e.three,e.React,e[\"chroma-js\"])}(window,function(e,t,r){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"/dist/\",r(r.s=26)}([function(t,r){t.exports=e},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,r){e.exports=t},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}},function(e,t,r){var n=r(27),s=r(4);e.exports=function(e,t){return!t||\"object\"!==n(t)&&\"function\"!=typeof t?s(e):t}},function(e,t){function r(t){return e.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(t)}e.exports=r},function(e,t,r){var n=r(28);e.exports=function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}},function(e,t,r){var n=r(13),s=r(31),i=r(15);e.exports=function(e,t){return n(e)||s(e,t)||i()}},function(e,t){e.exports=r},function(e,t,r){var n=r(29),s=r(14),i=r(30);e.exports=function(e){return n(e)||s(e)||i()}},function(e,t,r){var n=r(33);\"string\"==typeof n&&(n=[[e.i,n,\"\"]]);var s={hmr:!0,transform:void 0,insertInto:void 0};r(17)(n,s);n.locals&&(e.exports=n.locals)},function(e,t,r){var n=r(35);\"string\"==typeof n&&(n=[[e.i,n,\"\"]]);var s={hmr:!0,transform:void 0,insertInto:void 0};r(17)(n,s);n.locals&&(e.exports=n.locals)},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}},function(e,t,r){\"use strict\";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=function(e,t){var r=e[1]||\"\",n=e[3];if(!n)return r;if(t&&\"function\"==typeof btoa){var s=(o=n,\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,\"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+\" */\"),i=n.sources.map(function(e){return\"/*# sourceURL=\"+n.sourceRoot+e+\" */\"});return[r].concat(i).concat([s]).join(\"\\n\")}var o;return[r].join(\"\\n\")}(t,e);return t[2]?\"@media \"+t[2]+\"{\"+r+\"}\":r}).join(\"\")},t.i=function(e,r){\"string\"==typeof e&&(e=[[null,e,\"\"]]);for(var n={},s=0;s<this.length;s++){var i=this[s][0];null!=i&&(n[i]=!0)}for(s=0;s<e.length;s++){var o=e[s];null!=o[0]&&n[o[0]]||(r&&!o[2]?o[2]=r:r&&(o[2]=\"(\"+o[2]+\") and (\"+r+\")\"),t.push(o))}},t}},function(e,t,r){var n,s,i={},o=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(e){var t={};return function(e,r){if(\"function\"==typeof e)return e();if(void 0===t[e]){var n=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}}(),l=null,u=0,h=[],c=r(34);function d(e,t){for(var r=0;r<e.length;r++){var n=e[r],s=i[n.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](n.parts[o]);for(;o<n.parts.length;o++)s.parts.push(y(n.parts[o],t))}else{var a=[];for(o=0;o<n.parts.length;o++)a.push(y(n.parts[o],t));i[n.id]={id:n.id,refs:1,parts:a}}}}function f(e,t){for(var r=[],n={},s=0;s<e.length;s++){var i=e[s],o=t.base?i[0]+t.base:i[0],a={css:i[1],media:i[2],sourceMap:i[3]};n[o]?n[o].parts.push(a):r.push(n[o]={id:o,parts:[a]})}return r}function m(e,t){var r=a(e.insertInto);if(!r)throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");var n=h[h.length-1];if(\"top\"===e.insertAt)n?n.nextSibling?r.insertBefore(t,n.nextSibling):r.appendChild(t):r.insertBefore(t,r.firstChild),h.push(t);else if(\"bottom\"===e.insertAt)r.appendChild(t);else{if(\"object\"!=typeof e.insertAt||!e.insertAt.before)throw new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");var s=a(e.insertAt.before,r);r.insertBefore(t,s)}}function p(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=h.indexOf(e);t>=0&&h.splice(t,1)}function v(e){var t=document.createElement(\"style\");if(void 0===e.attrs.type&&(e.attrs.type=\"text/css\"),void 0===e.attrs.nonce){var n=function(){0;return r.nc}();n&&(e.attrs.nonce=n)}return g(t,e.attrs),m(e,t),t}function g(e,t){Object.keys(t).forEach(function(r){e.setAttribute(r,t[r])})}function y(e,t){var r,n,s,i;if(t.transform&&e.css){if(!(i=\"function\"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var o=u++;r=l||(l=v(t)),n=b.bind(null,r,o,!1),s=b.bind(null,r,o,!0)}else e.sourceMap&&\"function\"==typeof URL&&\"function\"==typeof URL.createObjectURL&&\"function\"==typeof URL.revokeObjectURL&&\"function\"==typeof Blob&&\"function\"==typeof btoa?(r=function(e){var t=document.createElement(\"link\");return void 0===e.attrs.type&&(e.attrs.type=\"text/css\"),e.attrs.rel=\"stylesheet\",g(t,e.attrs),m(e,t),t}(t),n=function(e,t,r){var n=r.css,s=r.sourceMap,i=void 0===t.convertToAbsoluteUrls&&s;(t.convertToAbsoluteUrls||i)&&(n=c(n));s&&(n+=\"\\n/*# sourceMappingURL=data:application/json;base64,\"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+\" */\");var o=new Blob([n],{type:\"text/css\"}),a=e.href;e.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}.bind(null,r,t),s=function(){p(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(t),n=function(e,t){var r=t.css,n=t.media;n&&e.setAttribute(\"media\",n);if(e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}.bind(null,r),s=function(){p(r)});return n(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n(e=t)}else s()}}e.exports=function(e,t){if(\"undefined\"!=typeof DEBUG&&DEBUG&&\"object\"!=typeof document)throw new Error(\"The style-loader cannot be used in a non-browser environment\");(t=t||{}).attrs=\"object\"==typeof t.attrs?t.attrs:{},t.singleton||\"boolean\"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto=\"head\"),t.insertAt||(t.insertAt=\"bottom\");var r=f(e,t);return d(r,t),function(e){for(var n=[],s=0;s<r.length;s++){var o=r[s];(a=i[o.id]).refs--,n.push(a)}e&&d(f(e,t),t);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete i[a.id]}}}};var w,x=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join(\"\\n\")});function b(e,t,r,n){var s=r?\"\":n.css;if(e.styleSheet)e.styleSheet.cssText=x(t,s);else{var i=document.createTextNode(s),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}},function(e,t,r){var n=r(13),s=r(14),i=r(15);e.exports=function(e){return n(e)||s(e)||i()}},function(e,t){e.exports=\"/** helper functions to change colour spaces */\\r\\n\\r\\n// RGB to HueSaturationValue\\r\\nvec3 rgb2hsv(vec3 c)\\r\\n{\\r\\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\\r\\n    //vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\\r\\n    //vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\\r\\n\\tvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\\r\\n    vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\\r\\n\\r\\n    float d = q.x - min(q.w, q.y);\\r\\n    float e = 1.0e-10;\\r\\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\\r\\n}\\r\\n// HueSaturationValue to RGB\\r\\nvec3 hsv2rgb(vec3 c)\\r\\n{\\r\\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\r\\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\r\\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\r\\n}\\r\\n\\r\\n/***\\r\\n* next some transforms from RGB to HueSaturationLightness and back\\r\\n***/\\r\\n\\r\\n// http://stackoverflow.com/questions/5919663/how-does-photoshop-blend-two-images-together\\r\\nfloat ColorTransform_HUE_to_RGB(float m1, float m2, float hue){\\r\\n\\tif (hue<0.0)\\r\\n\\t\\thue+=1.0;\\r\\n\\telse if (hue>1.0)\\r\\n\\t\\thue-=1.0;\\r\\n\\r\\n\\tfloat c; // single color channel (R G or B)\\r\\n\\tif (6.0*hue<1.0)\\r\\n\\t\\tc = m1+(m2-m1)*hue*6.0;\\r\\n\\telse if (2.0*hue<1.0)\\r\\n\\t\\tc = m2;\\r\\n\\telse if (3.0*hue<2.0)\\r\\n\\t\\tc = m1+(m2-m1)*(2.0/3.0-hue)*6.0;\\r\\n\\telse\\r\\n\\t\\tc = m1;\\r\\n\\r\\n\\treturn c;\\r\\n}\\r\\n\\r\\n// http://stackoverflow.com/questions/5919663/how-does-photoshop-blend-two-images-together\\r\\nvec3 ColorTransform_RGB_to_HSL(vec3 c){\\r\\n\\tfloat max = max(max(c.r,c.g),c.b);\\r\\n\\tfloat min =  min(min(c.r,c.g),c.b);\\r\\n\\tfloat delta = max-min;\\r\\n\\r\\n\\t// set Luminance (hsl.g)\\r\\n\\tvec3 hsl = vec3(0.0, 0.0, (max+min)/2.0); // Hue, Saturation, Luminance\\r\\n\\tif (delta==0.0){ // gray, no chroma at all\\r\\n\\t\\treturn hsl;\\r\\n\\t}\\r\\n\\r\\n\\t// set Saturation (hsl.b)\\r\\n\\tif (hsl.z<0.5){ // luminance < 0.5\\r\\n\\t\\thsl.y = delta / (max+min);\\r\\n\\t} else {\\r\\n\\t\\thsl.y = delta / (2.0-max-min);\\r\\n\\t}\\r\\n\\r\\n\\t// set Hue (hsl.r)\\r\\n\\tif (c.r==max){\\r\\n\\t\\thsl.x = (c.g-c.b)/delta;\\r\\n\\t} else if (c.g==max){\\r\\n\\t\\thsl.x = 2.0 + (c.b-c.r)/delta;\\r\\n\\t} else {\\r\\n\\t\\thsl.x = 4.0 + (c.r-c.g)/delta;\\r\\n\\t}\\r\\n\\thsl.x /= 6.0;\\r\\n\\r\\n\\tif (hsl.x<0.0) {hsl.x+=1.0;}\\r\\n\\telse if (hsl.x>1.0) {hsl.x-=1.0;} // not needed?\\r\\n\\r\\n\\treturn hsl;\\r\\n}\\r\\n\\r\\n// http://stackoverflow.com/questions/5919663/how-does-photoshop-blend-two-images-together\\r\\nvec3 ColorTransform_HSL_to_RGB(vec3 hsl){\\r\\n\\r\\n\\r\\n\\tif (hsl.y==0.0) // if no saturation, return luminance as rgb\\r\\n\\t\\treturn vec3(hsl.z);\\r\\n\\r\\n\\tfloat m1,m2;\\r\\n\\r\\n\\tif (hsl.z<=0.5){ // luminance low\\r\\n\\t\\tm2 = hsl.z*(1.0+hsl.y);//Lumination * (1.0 + Saturation);\\r\\n\\t} else { // luminance high\\r\\n\\t\\tm2 = hsl.z+hsl.y - hsl.z*hsl.y;//Lumination + Saturation - Lumination * Saturation;\\r\\n\\t}\\r\\n\\tm1 = 2.0*hsl.z-m2;//(2.0 * Lumination - M2);\\r\\n\\r\\n\\treturn vec3(\\r\\n\\t\\tColorTransform_HUE_to_RGB(m1,m2,hsl.x+1.0/3.0),\\r\\n\\t\\tColorTransform_HUE_to_RGB(m1,m2,hsl.x),\\r\\n\\t\\tColorTransform_HUE_to_RGB(m1,m2,hsl.x-1.0/3.0)\\r\\n\\t);\\r\\n}\\r\\n\\r\\n\\r\\n// Set the precision for data types used in this shader\\r\\nprecision highp float;\\r\\nprecision highp int;\\r\\n\\r\\n//attribute vec3 position; // THREE.js default\\r\\n//attribute vec3 normal; // THREE.js default\\r\\n//attribute vec2 uv; // THREE.js default\\r\\n//attribute vec2 uv2; // THREE.js default\\r\\n\\r\\n// Default THREE.js uniforms available to vertex shader\\r\\n//uniform mat4 modelMatrix;\\r\\n//uniform mat4 modelViewMatrix;\\r\\n//uniform mat4 projectionMatrix;\\r\\n//uniform mat4 viewMatrix;\\r\\n//uniform mat3 normalMatrix;\\r\\n\\r\\nuniform vec3 uVec3AmbientColor;\\r\\n\\r\\nuniform vec3 uVec3LightingDirection;\\r\\nuniform vec3 uVec3DirectionalColor;\\r\\n\\r\\nuniform bool ubUseLighting;\\r\\n\\r\\nuniform vec3 uVec3Color;\\r\\nuniform float ufSaturation;\\r\\n\\r\\nvarying vec2 vVec2TextureCoord;\\r\\nvarying vec3 vVec3LightWeighting;\\r\\n\\r\\nvarying vec3 vVec3Color;\\r\\n\\r\\n\\r\\n\\r\\nvoid main(void) {\\r\\n\\t\\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\r\\n\\t\\tvVec2TextureCoord = uv;\\r\\n\\r\\n\\t\\t//vVec3Color = uVec3Color;\\r\\n\\t\\tvVec3Color = rgb2hsv(uVec3Color);\\r\\n\\t\\tvVec3Color.g = vVec3Color.g * ufSaturation;\\r\\n\\t\\tvVec3Color = hsv2rgb(vVec3Color);\\r\\n\\r\\n\\t\\tif (!ubUseLighting) {\\r\\n\\t\\t\\t\\tvVec3LightWeighting = vec3(1.0, 1.0, 1.0);\\r\\n\\t\\t} else {\\r\\n\\t\\t\\t\\tvec3 transformedNormal = normalMatrix * normal;\\r\\n\\t\\t\\t\\tfloat directionalLightWeighting = abs(dot(transformedNormal, uVec3LightingDirection));// max(dot(transformedNormal, uVec3LightingDirection), 0.0); // (this would work for well-formed meshes)\\r\\n\\t\\t\\t\\tvVec3LightWeighting = uVec3AmbientColor + uVec3DirectionalColor * directionalLightWeighting;\\r\\n\\t\\t}\\r\\n}\\r\\n\"},function(e,t){e.exports=\"// Set the precision for data types used in this shader\\r\\nprecision highp float;\\r\\nprecision highp int;\\r\\n\\r\\nvarying vec2 vVec2TextureCoord;\\r\\nvarying vec3 vVec3LightWeighting;\\r\\n\\r\\nuniform vec3 uVec3Color;\\r\\nuniform float ufSaturation;\\r\\n\\r\\nvarying vec3 vVec3Color;\\r\\n\\r\\n//uniform sampler2D uSampler;\\r\\n\\r\\nvoid main(void) {\\r\\n    gl_FragColor = vec4(vVec3Color * vVec3LightWeighting, 1.0);\\r\\n\\t\\t//gl_FragColor = vec4(1.0,1.0,0.0,1.0);\\r\\n}\\r\\n\"},function(e,t){e.exports=\"// Set the precision for data types used in this shader\\r\\nprecision highp float;\\r\\nprecision highp int;\\r\\n\\r\\n//attribute vec3 position; // THREE.js default\\r\\n//attribute vec3 normal; // THREE.js default\\r\\n//attribute vec2 uv; // THREE.js default\\r\\n//attribute vec2 uv2; // THREE.js default\\r\\n\\r\\n// Default THREE.js uniforms available to vertex shader\\r\\n//uniform mat4 modelMatrix;\\r\\n//uniform mat4 modelViewMatrix;\\r\\n//uniform mat4 projectionMatrix;\\r\\n//uniform mat4 viewMatrix;\\r\\n//uniform mat3 normalMatrix;\\r\\n\\r\\nvarying vec2 vVec2TextureCoord;\\r\\n\\r\\nvoid main(void) {\\r\\n  vVec2TextureCoord = uv;\\r\\n  //gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\r\\n  gl_Position = vec4( position, 1.0 );\\r\\n}\\r\\n\"},function(e,t){e.exports=\"// Set the precision for data types used in this shader\\r\\nprecision highp float;\\r\\nprecision highp int;\\r\\n\\r\\nuniform sampler2D texDepthBuffer;\\r\\nuniform sampler2D texCustomDepthBuffer;\\r\\n//uniform sampler2D texSilhouetteAccumulatedBuffer;\\r\\n\\r\\nvarying vec2 vVec2TextureCoord;\\r\\n\\r\\nuniform vec2 resolution;\\r\\n//const float ts = 0.092929; +0.9\\r\\n//const float tc = 0.097544; +0.9\\r\\nuniform float scaleDepthValues;\\r\\nuniform float ts;\\r\\nuniform float tc;\\r\\n// |A|B|C|\\r\\n// |D|X|E|\\r\\n// |F|G|H|\\r\\nfloat X,A,B,C,D,E,F,G,H; // depths\\r\\nfloat Asw,Bsw,Csw,Dsw,Esw,Fsw,Gsw,Hsw;// silhouette weights\\r\\nfloat Acw,Bcw,Ccw,Dcw,Ecw,Fcw,Gcw,Hcw;// crease weigths\\r\\nvoid loadValues() {\\r\\n\\tvec2 tCoord = vVec2TextureCoord;\\r\\n\\tfloat xc = tCoord.x;\\r\\n\\tfloat xm = tCoord.x-resolution.x;\\r\\n\\tfloat xp = tCoord.x+resolution.x;\\r\\n\\tfloat yc = tCoord.y;\\r\\n\\tfloat ym = tCoord.y-resolution.y;\\r\\n\\tfloat yp = tCoord.y+resolution.y;\\r\\n\\tX = texture2D(texCustomDepthBuffer,vec2(xc,yc)).r;\\r\\n\\tA = texture2D(texCustomDepthBuffer,vec2(xm,yp)).r;\\r\\n\\tB = texture2D(texCustomDepthBuffer,vec2(xc,yp)).r;\\r\\n\\tC = texture2D(texCustomDepthBuffer,vec2(xp,yp)).r;\\r\\n\\tD = texture2D(texCustomDepthBuffer,vec2(xm,yc)).r;\\r\\n\\tE = texture2D(texCustomDepthBuffer,vec2(xp,yc)).r;\\r\\n\\tF = texture2D(texCustomDepthBuffer,vec2(xm,ym)).r;\\r\\n\\tG = texture2D(texCustomDepthBuffer,vec2(xc,ym)).r;\\r\\n\\tH = texture2D(texCustomDepthBuffer,vec2(xp,ym)).r;\\r\\n}\\r\\nfloat silhouetteWeight(in float s) {\\r\\n\\tfloat t2 = 0.9+ts;\\r\\n\\tfloat t1 = t2-0.01;\\r\\n\\treturn smoothstep(t1,t2,max(1.0-abs(s * scaleDepthValues),0.9));\\r\\n}\\r\\nfloat shadowWeight(in float s) {\\r\\n\\tfloat t2 = 0.9+tc;\\r\\n\\tfloat t1 = t2-0.01;\\r\\n\\treturn smoothstep(t1,t2,max(1.0-abs(s * scaleDepthValues),0.9));\\r\\n}\\r\\nvoid computeSilhouetteWeights() {\\r\\n\\tAsw = silhouetteWeight(A-X);\\r\\n\\tBsw = silhouetteWeight(B-X);\\r\\n\\tCsw = silhouetteWeight(C-X);\\r\\n\\tDsw = silhouetteWeight(D-X);\\r\\n\\tEsw = silhouetteWeight(E-X);\\r\\n\\tFsw = silhouetteWeight(F-X);\\r\\n\\tGsw = silhouetteWeight(G-X);\\r\\n\\tHsw = silhouetteWeight(H-X);\\r\\n}\\r\\nvoid computeShadowWeights() {\\r\\n\\tAcw = shadowWeight(A-X);\\r\\n\\tBcw = shadowWeight(B-X);\\r\\n\\tCcw = shadowWeight(C-X);\\r\\n\\tDcw = shadowWeight(D-X);\\r\\n\\tEcw = shadowWeight(E-X);\\r\\n\\tFcw = shadowWeight(F-X);\\r\\n\\tGcw = shadowWeight(G-X);\\r\\n\\tHcw = shadowWeight(H-X);\\r\\n}\\r\\nvoid main(void) {\\r\\n\\tloadValues();\\r\\n\\tcomputeSilhouetteWeights();\\r\\n\\tfloat meansw = (Asw+Bsw+Csw+Dsw+Esw+Fsw+Gsw+Hsw)/8.0; // silhoutte\\r\\n\\tcomputeShadowWeights();\\r\\n\\tfloat meanShadoww = (Acw+Bcw+Ccw+Dcw+Ecw+Fcw+Gcw+Hcw)/8.0; // shadow\\r\\n\\r\\n\\tif (meanShadoww < 0.4) {// dark shadow\\r\\n\\t\\tmeansw = min(meansw,0.4);\\r\\n\\t} else if (meanShadoww < 0.8) { // light shadow\\r\\n\\t\\tmeansw = min(meansw,0.8);\\r\\n\\t}\\r\\n\\r\\n\\tfloat shadowDark = smoothstep(.38, .5, meanShadoww)+.4;\\r\\n\\tfloat shadowLight = smoothstep(.78, .99, meanShadoww)+.8;\\r\\n\\r\\n\\tif (meanShadoww < 0.7) {// dark shadow\\r\\n\\t\\tmeansw = min(meansw, shadowDark);\\r\\n\\t}\\r\\n\\tif (meanShadoww < 0.9) { // light shadow\\r\\n\\t\\tmeansw = min(meansw, shadowLight);\\r\\n\\t}\\r\\n\\r\\n\\t/* float depth = texture2D(texCustomDepthBuffer, vVec2TextureCoord).r; // keep depth from MeshDepthMaterial for mixing multiple silhouettes (and mixing in volume renderer)\\r\\n\\tfloat depthPreviousSilhouette = texture2D(texSilhouetteAccumulatedBuffer, vVec2TextureCoord).g; // depth of the accumulated silhouette texture\\r\\n\\r\\n\\tif (depthPreviousSilhouette > depth) {\\r\\n\\t\\t//discard;\\r\\n\\t\\treturn;\\r\\n\\t} */\\r\\n\\tfloat depth = texture2D(texDepthBuffer, vVec2TextureCoord).r; // depth from an actual depth buffer attachment\\r\\n\\r\\n\\tif (meansw == 1.0) {\\r\\n\\t\\tgl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\t} else {\\r\\n\\t\\t//meansw = 1.0 - meansw; // now above 0.0\\r\\n\\t\\tgl_FragColor = vec4(meansw, 1.0, 0.0, 0.0);\\r\\n\\t}\\r\\n\\t\\r\\n\\t//vec2 tCoord = vVec2TextureCoord;\\r\\n\\t//gl_FragColor = vec4(texture2D(texCustomDepthBuffer, vVec2TextureCoord) * 700.0);\\r\\n}\\r\\n\"},function(e,t){e.exports=\"// Set the precision for data types used in this shader\\r\\nprecision highp float;\\r\\nprecision highp int;\\r\\n\\r\\n//attribute vec3 position; // THREE.js default\\r\\n//attribute vec3 normal; // THREE.js default\\r\\n//attribute vec2 uv; // THREE.js default\\r\\n//attribute vec2 uv2; // THREE.js default\\r\\n\\r\\n// Default THREE.js uniforms available to vertex shader\\r\\n//uniform mat4 modelMatrix;\\r\\n//uniform mat4 modelViewMatrix;\\r\\n//uniform mat4 projectionMatrix;\\r\\n//uniform mat4 viewMatrix;\\r\\n//uniform mat3 normalMatrix;\\r\\n\\r\\nvarying vec2 vVec2TextureCoord;\\r\\n\\r\\nvoid main(void) {\\r\\n  vVec2TextureCoord = uv;\\r\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\r\\n}\\r\\n\"},function(e,t){e.exports=\"//@xxixxmport ../includes/weightWBOIT;\\r\\n/** Cosgrove and Stoops */\\r\\n\\r\\n// Set the precision for data types used in this shader\\r\\nprecision highp float;\\r\\nprecision highp int;\\r\\n\\r\\n//uniform sampler2D tDiffuse;\\r\\nuniform sampler2D texSilhouette;\\r\\n//uniform sampler2D texTransparency;\\r\\nuniform sampler2D texOpaque;\\r\\nuniform sampler2D texContour;\\r\\nuniform sampler2D texGlow;\\r\\n\\r\\n\\r\\nvarying vec2 vVec2TextureCoord;\\r\\n\\r\\nvoid main(void) {\\r\\n\\t//vec4 t = texture2D( texTransparency, vVec2TextureCoord );\\r\\n\\tvec4 s = texture2D( texSilhouette, vVec2TextureCoord );\\r\\n\\tvec4 op = texture2D( texOpaque, vVec2TextureCoord );\\r\\n\\tvec4 c = texture2D( texContour, vVec2TextureCoord );\\r\\n\\tvec4 g = texture2D( texGlow, vVec2TextureCoord );\\r\\n\\r\\n\\tvec4 o = vec4(1.0, 1.0, 1.0, 1.0); // white background\\r\\n\\to = s;\\r\\n\\tif (op.r > 0.0  || op.g > 0.0 || op.b > 0.0){ // something opaque\\r\\n\\t\\to = o * (1.0-o.r) + op * (o.r);\\r\\n\\t}\\r\\n\\t/* if (t.r > 0.0 || t.g > 0.0 || t.b > 0.0){ // something transparent\\r\\n\\t\\to = o * (t.a) + t * (1.0-t.a);\\r\\n\\t} */\\r\\n\\tif (c.r > 0.0 || c.g > 0.0 || c.b > 0.0) { // there is a coloured contour\\r\\n\\t\\to = c;\\r\\n\\t}\\r\\n\\to = o + g;\\r\\n\\tgl_FragColor = o;\\r\\n}\\r\\n\"},function(e,t){e.exports=\"varying vec2 vVec2TextureCoord;\\r\\nuniform sampler2D meshRendererTex, meshRendererDepthTex, backgroundTex, foregroundTex, atlasTex, tfTex, silhouetteTex, silhouetteDepthTex;\\r\\nuniform float stepLength;\\r\\n//uniform float alphaCorrection;\\r\\nuniform int atlasColumns;\\r\\nuniform int atlasRows;\\r\\nuniform int atlasSliceNum;\\r\\nuniform mat4 viewProjectionInverse; // restores view position from mesh renderer's depth texture\\r\\nuniform vec3 volumeSize;\\r\\nuniform vec3 backgroundColour;\\r\\n\\r\\nuniform int channel0visible, channel1visible, channel2visible, channel3visible;\\r\\n\\r\\n\\r\\nconst int MAX_STEPS = 1024;\\r\\n\\r\\nvec4 texture3D(sampler2D tex, vec3 pos) {\\r\\n\\tpos = clamp(pos, 0.0, 1.0);\\r\\n\\r\\n\\tfloat rslice = pos.z * float(atlasSliceNum-1);\\r\\n\\tfloat slice = floor(rslice);\\r\\n\\tfloat frac = rslice-slice;\\r\\n\\r\\n\\tfloat col1 = mod(slice, float(atlasColumns));\\r\\n\\tfloat row1 = floor(slice / float(atlasColumns));\\r\\n\\r\\n\\tfloat offsetX1 = col1 / float(atlasColumns);\\r\\n\\tfloat offsetY1 = row1 / float(atlasRows);\\r\\n\\r\\n\\tvec2 atlasPos1 = vec2(\\r\\n\\t\\t\\toffsetX1 + pos.x/float(atlasColumns),\\r\\n\\t\\t\\toffsetY1 + pos.y/float(atlasRows)\\r\\n\\t\\t\\t);\\r\\n\\r\\n\\tvec4 s1 = texture2D(tex, atlasPos1);\\r\\n\\r\\n\\tfloat col2 = mod(slice+1.0, float(atlasColumns));\\r\\n\\tfloat row2 = floor((slice+1.0) / float(atlasColumns));\\r\\n\\r\\n\\tfloat offsetX2 = col2 / float(atlasColumns);\\r\\n\\tfloat offsetY2 = row2 / float(atlasRows);\\r\\n\\r\\n\\tvec2 atlasPos2 = vec2(\\r\\n\\t\\t\\toffsetX2 + pos.x/float(atlasColumns),\\r\\n\\t\\t\\toffsetY2 + pos.y/float(atlasRows)\\r\\n\\t\\t\\t);\\r\\n\\r\\n\\tvec4 s2 = texture2D(tex, atlasPos2);\\r\\n\\treturn mix(s1, s2, frac);\\r\\n}\\r\\n\\r\\nvec4 shade(int channel, float value) {\\r\\n\\tvec4 shaded = texture2D(tfTex, vec2(value, float(channel)/3.0));\\r\\n\\tshaded.rgb *= shaded.a;\\r\\n\\treturn shaded;\\r\\n}\\r\\n\\r\\n\\r\\nvoid main( void ) {\\r\\n\\r\\n\\tvec2 texc = vVec2TextureCoord; // range [0,1]\\r\\n\\r\\n\\tvec3 v3_meshColour = texture2D(meshRendererTex, texc).rgb;\\r\\n\\tfloat f_meshDepth = texture2D(meshRendererDepthTex, texc).r;\\r\\n\\tvec2 v2_silhouette = texture2D(silhouetteTex, texc).rg; // x = sil grey value, y = depth\\r\\n\\tfloat f_silhouetteDepth = texture2D(silhouetteDepthTex, texc).r;\\r\\n\\tvec3 backPos = texture2D(backgroundTex, texc).xyz; // world space\\r\\n\\tvec3 frontPos = texture2D(foregroundTex, texc).xyz; // world space\\r\\n\\t\\r\\n\\t// TODO: use matVolume for scaling+transformation instead of volumeSize\\r\\n\\tbackPos /= volumeSize; // volume space [0,1]\\r\\n\\tfrontPos /= volumeSize; // volume space [0,1]\\r\\n\\r\\n\\t/* gl_FragColor = vec4(\\r\\n\\t\\tfrontPos,// * 0.01,\\r\\n\\t\\t1.0\\r\\n\\t);\\r\\n\\treturn; */\\r\\n\\r\\n\\tvec4 meshPosProjSpace = vec4(2.0*vec3(texc.x, texc.y, f_meshDepth)-1.0, 1.0); // ProjSpace is NDC\\r\\n\\tvec4 meshPosWorldSpace = viewProjectionInverse * meshPosProjSpace; // project back into world pos\\r\\n\\tmeshPosWorldSpace /= meshPosWorldSpace.w; // homogenize\\r\\n\\tmeshPosWorldSpace.xyz = meshPosWorldSpace.xyz / volumeSize; // go from world pos to volume pos [0,1]\\r\\n\\r\\n\\tvec4 silPosProjSpace = vec4(2.0*vec3(texc.x, texc.y, f_silhouetteDepth)-1.0, 1.0); // ProjSpace is NDC\\r\\n\\tvec4 silPosWorldSpace = viewProjectionInverse * silPosProjSpace; // project back into world pos\\r\\n\\tsilPosWorldSpace /= silPosWorldSpace.w; // homogenize\\r\\n\\tsilPosWorldSpace.xyz = silPosWorldSpace.xyz / volumeSize; // go from world pos to volume pos [0,1]\\r\\n\\r\\n\\tvec3 ray = backPos - frontPos;\\r\\n\\tfloat rayLength = length(ray);\\r\\n\\r\\n\\tvec3 rayToMesh = meshPosWorldSpace.xyz - frontPos;\\r\\n\\tfloat f_rayToMeshLength = length(rayToMesh);\\r\\n\\tvec3 rayToSilhouette = silPosWorldSpace.xyz - frontPos;\\r\\n\\tfloat f_rayToSilhouetteLength = length(rayToSilhouette);\\r\\n\\r\\n\\tvec3 step = (ray / rayLength) * stepLength;\\r\\n\\tvec3 pos = frontPos;\\r\\n\\r\\n\\tvec3 accumColor = vec3(0.0,0.0,0.0);\\r\\n\\tfloat dist = 0.0;\\r\\n\\tfloat accumAlpha = 0.0;\\r\\n\\tfloat maxIntensity = 0.0;\\r\\n\\r\\n\\tvec3 v3_opaqueMaterial = vec3(0.0); // this can be an opaque mesh or a silhouette\\r\\n\\r\\n\\tfor(int i=0; i<MAX_STEPS; i++) {\\r\\n\\t\\tvec4 sample = texture3D(atlasTex, pos);\\r\\n\\t\\tvec4 shaded = vec4(0.0, 0.0, 0.0, 0.0);\\r\\n\\t\\tfloat intensity = 0.0;\\r\\n\\r\\n\\t\\tif(channel0visible == 1) {\\r\\n\\t\\t\\tvec4 shadeVal = shade(0, sample.x);\\r\\n\\t\\t\\tshaded += shadeVal;\\r\\n\\t\\t\\tintensity += (sample.x * sample.x * float(shadeVal.a > 0.0));\\r\\n\\t\\t}\\r\\n\\t\\tif(channel1visible == 1) {\\r\\n\\t\\t\\tvec4 shadeVal = shade(1, sample.y);\\r\\n\\t\\t\\tshaded += shadeVal;\\r\\n\\t\\t\\tintensity += (sample.y * sample.y * float(shadeVal.a > 0.0));\\r\\n\\t\\t}\\r\\n\\t\\tif(channel2visible == 1) {\\r\\n\\t\\t\\tvec4 shadeVal = shade(2, sample.z);\\r\\n\\t\\t\\tshaded += shadeVal;\\r\\n\\t\\t\\tintensity += (sample.z * sample.z * float(shadeVal.a > 0.0));\\r\\n\\t\\t}\\r\\n\\t\\tif(channel3visible == 1) {\\r\\n\\t\\t\\tvec4 shadeVal = shade(3, sample.w);\\r\\n\\t\\t\\tshaded += shadeVal;\\r\\n\\t\\t\\tintensity += (sample.w * sample.w * float(shadeVal.a > 0.0));\\r\\n\\t\\t}\\r\\n\\r\\n\\r\\n\\t\\tvec3 color = shaded.rgb;\\r\\n\\t\\tfloat alpha = shaded.a;\\r\\n\\r\\n\\t\\tintensity = sqrt(intensity);\\r\\n\\r\\n\\t\\tfloat delta = 0.0;\\r\\n\\t\\tif(intensity > maxIntensity) {\\r\\n\\t\\t\\tdelta = intensity - maxIntensity;\\r\\n\\t\\t\\tmaxIntensity = intensity;\\r\\n\\t\\t}\\r\\n\\r\\n\\r\\n\\t\\tfloat beta = 1.0 - delta;\\r\\n\\r\\n\\t\\taccumColor = beta * accumColor + (1.0 - beta * accumAlpha) * color;\\r\\n\\t\\taccumAlpha = beta * accumAlpha + (1.0 - beta * accumAlpha) * alpha;\\r\\n\\r\\n\\r\\n\\t\\tif(accumAlpha > 0.99) {\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t\\r\\n\\t\\tif(dist >= rayLength) {\\r\\n\\t\\t\\t// the ray accumulation has hit the background: mix with background colour\\r\\n\\t\\t\\taccumColor = accumColor + (1.0-accumAlpha) * backgroundColour;\\r\\n\\t\\t\\taccumAlpha = 1.0;\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tif(dist >= f_rayToSilhouetteLength && v2_silhouette.g == 1.0) {\\r\\n\\t\\t\\t// NO early ray termination when we hit a silhouette -> we want it transparent -> put it on top with a lot of alpha!\\r\\n\\t\\t\\tv2_silhouette.g = 0.5; // only do this once\\r\\n\\t\\t\\t\\r\\n\\t\\t\\tfloat s = v2_silhouette.r; // change to 1.0 - s iff background is dark\\r\\n\\t\\t\\tfloat t = 1.0 - v2_silhouette.r; // transparency of the silhouette\\r\\n\\t\\t\\t\\r\\n\\t\\t\\t// assume bright background colour\\r\\n\\t\\t\\taccumColor = vec3(s*0.01); // strong lines should be black, fade out to grey at the edges\\r\\n\\t\\t\\taccumAlpha = 0.99*t; // We could change the overall transparency of the silhouette with a uniform!\\r\\n\\r\\n\\t\\t\\t// super basic way to decide between black and white silhouette\\r\\n\\t\\t\\tfloat averageRGB = (backgroundColour.r + backgroundColour.g + backgroundColour.b) / 3.0;\\r\\n\\t\\t\\t//change silhouette colour based on background colour\\r\\n\\t\\t\\tif (averageRGB < 0.5) {\\r\\n\\t\\t\\t\\t// dark background (only tested with black)\\r\\n\\t\\t\\t\\ts = 1.0 - s; // invert silhouette lines (strong=white, fades out to grey)\\r\\n\\t\\t\\t\\taccumColor = vec3(s*1.3); // just a bit more white\\r\\n\\t\\t\\t}\\r\\n\\t\\t}\\r\\n\\t\\tif(dist >= f_rayToMeshLength) {\\r\\n\\t\\t\\t// early ray termination when we hit an opaque mesh\\r\\n\\t\\t\\tv3_opaqueMaterial = v3_meshColour;\\r\\n\\t\\t\\tbreak;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\tpos += step;\\r\\n\\t\\tdist += stepLength;\\r\\n\\t}\\r\\n\\r\\n\\tvec4 volRendererCol = vec4(accumColor, accumAlpha);\\r\\n\\t\\r\\n\\t// composite volume and meshColour\\r\\n\\tvec4 v4_volmesh = vec4(\\r\\n\\t\\tvolRendererCol.rgb * volRendererCol.w + v3_opaqueMaterial * (1.0-volRendererCol.w),\\r\\n\\t\\t1.0\\r\\n\\t);\\r\\n\\r\\n\\tgl_FragColor = v4_volmesh;\\r\\n}\\r\\n\"},function(e,t,r){e.exports=r(36)},function(e,t){function r(e){return(r=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function n(t){return\"function\"==typeof Symbol&&\"symbol\"===r(Symbol.iterator)?e.exports=n=function(e){return r(e)}:e.exports=n=function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":r(e)},n(t)}e.exports=n},function(e,t){function r(t,n){return e.exports=r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(t,n)}e.exports=r},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}},function(e,t){e.exports=function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}},function(e,t){e.exports=function(e,t){var r=[],n=!0,s=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){s=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(s)throw i}}return r}},function(e,t,r){var n=r(0);n.TrackballControls=function(e,t){var r=this,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new n.Vector3;var i=new n.Vector3,o=s.NONE,a=s.NONE,l=new n.Vector3,u=new n.Vector2,h=new n.Vector2,c=new n.Vector3,d=0,f=new n.Vector2,m=new n.Vector2,p=0,v=0,g=new n.Vector2,y=new n.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var w={type:\"change\"},x={type:\"start\"},b={type:\"end\"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var S,C,T,k,M,_,D,B,R,P,E,V=(S=new n.Vector2,function(e,t){return S.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),S}),L=function(){var e=new n.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function O(e){!1!==r.enabled&&(window.removeEventListener(\"keydown\",O),a=o,o===s.NONE&&(e.keyCode!==r.keys[s.ROTATE]||r.noRotate?e.keyCode!==r.keys[s.ZOOM]||r.noZoom?e.keyCode!==r.keys[s.PAN]||r.noPan||(o=s.PAN):o=s.ZOOM:o=s.ROTATE))}function A(e){!1!==r.enabled&&(o=a,window.addEventListener(\"keydown\",O,!1))}function z(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o===s.NONE&&(o=e.button),o!==s.ROTATE||r.noRotate?o!==s.ZOOM||r.noZoom?o!==s.PAN||r.noPan||(g.copy(V(e.pageX,e.pageY)),y.copy(g)):(f.copy(V(e.pageX,e.pageY)),m.copy(f)):(h.copy(L(e.pageX,e.pageY)),u.copy(h)),document.addEventListener(\"mousemove\",j,!1),document.addEventListener(\"mouseup\",U,!1),r.dispatchEvent(x))}function j(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o!==s.ROTATE||r.noRotate?o!==s.ZOOM||r.noZoom?o!==s.PAN||r.noPan||y.copy(V(e.pageX,e.pageY)):m.copy(V(e.pageX,e.pageY)):(u.copy(h),h.copy(L(e.pageX,e.pageY))))}function U(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),o=s.NONE,document.removeEventListener(\"mousemove\",j),document.removeEventListener(\"mouseup\",U),r.dispatchEvent(b))}function N(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:f.y-=.025*e.deltaY;break;case 1:f.y-=.01*e.deltaY;break;default:f.y-=25e-5*e.deltaY}r.dispatchEvent(x),r.dispatchEvent(b)}}function F(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:o=s.TOUCH_ROTATE,h.copy(L(e.touches[0].pageX,e.touches[0].pageY)),u.copy(h);break;default:o=s.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;v=p=Math.sqrt(t*t+n*n);var i=(e.touches[0].pageX+e.touches[1].pageX)/2,a=(e.touches[0].pageY+e.touches[1].pageY)/2;g.copy(V(i,a)),y.copy(g)}r.dispatchEvent(x)}}function W(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:u.copy(h),h.copy(L(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;v=Math.sqrt(t*t+n*n);var s=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;y.copy(V(s,i))}}function q(e){if(!1!==r.enabled){switch(e.touches.length){case 0:o=s.NONE;break;case 1:o=s.TOUCH_ROTATE,h.copy(L(e.touches[0].pageX,e.touches[0].pageY)),u.copy(h)}r.dispatchEvent(b)}}function H(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=(T=new n.Vector3,k=new n.Quaternion,M=new n.Vector3,_=new n.Vector3,D=new n.Vector3,B=new n.Vector3,function(){B.set(h.x-u.x,h.y-u.y,0),(C=B.length())?(l.copy(r.object.position).sub(r.target),M.copy(l).normalize(),_.copy(r.object.up).normalize(),D.crossVectors(_,M).normalize(),_.setLength(h.y-u.y),D.setLength(h.x-u.x),B.copy(_.add(D)),T.crossVectors(B,l).normalize(),C*=r.rotateSpeed,k.setFromAxisAngle(T,C),l.applyQuaternion(k),r.object.up.applyQuaternion(k),c.copy(T),d=C):!r.staticMoving&&d&&(d*=Math.sqrt(1-r.dynamicDampingFactor),l.copy(r.object.position).sub(r.target),k.setFromAxisAngle(c,d),l.applyQuaternion(k),r.object.up.applyQuaternion(k)),u.copy(h)}),this.zoomCamera=function(){var e;o===s.TOUCH_ZOOM_PAN?(e=p/v,p=v,l.multiplyScalar(e)):(1!==(e=1+(m.y-f.y)*r.zoomSpeed)&&e>0&&l.multiplyScalar(e),r.staticMoving?f.copy(m):f.y+=(m.y-f.y)*this.dynamicDampingFactor)},this.panCamera=(R=new n.Vector2,P=new n.Vector3,E=new n.Vector3,function(){R.copy(y).sub(g),R.lengthSq()&&(R.multiplyScalar(l.length()*r.panSpeed),E.copy(l).cross(r.object.up).setLength(R.x),E.add(P.copy(r.object.up).setLength(R.y)),r.object.position.add(E),r.target.add(E),r.staticMoving?g.copy(y):g.add(R.subVectors(y,g).multiplyScalar(r.dynamicDampingFactor)))}),this.checkDistances=function(){r.noZoom&&r.noPan||(l.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,l.setLength(r.maxDistance)),f.copy(m)),l.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,l.setLength(r.minDistance)),f.copy(m)))},this.update=function(){l.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,l),r.checkDistances(),r.object.lookAt(r.target),i.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(w),i.copy(r.object.position))},this.reset=function(){o=s.NONE,a=s.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),l.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(w),i.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener(\"contextmenu\",H,!1),this.domElement.removeEventListener(\"mousedown\",z,!1),this.domElement.removeEventListener(\"wheel\",N,!1),this.domElement.removeEventListener(\"touchstart\",F,!1),this.domElement.removeEventListener(\"touchend\",q,!1),this.domElement.removeEventListener(\"touchmove\",W,!1),document.removeEventListener(\"mousemove\",j,!1),document.removeEventListener(\"mouseup\",U,!1),window.removeEventListener(\"keydown\",O,!1),window.removeEventListener(\"keyup\",A,!1)},this.domElement.addEventListener(\"contextmenu\",H,!1),this.domElement.addEventListener(\"mousedown\",z,!1),this.domElement.addEventListener(\"wheel\",N,!1),this.domElement.addEventListener(\"touchstart\",F,!1),this.domElement.addEventListener(\"touchend\",q,!1),this.domElement.addEventListener(\"touchmove\",W,!1),window.addEventListener(\"keydown\",O,!1),window.addEventListener(\"keyup\",A,!1),this.handleResize(),this.update()},n.TrackballControls.prototype=Object.create(n.EventDispatcher.prototype),n.TrackballControls.prototype.constructor=n.TrackballControls,e.exports=n.TrackballControls},function(e,t,r){(t=e.exports=r(16)(!1)).push([e.i,\"span.CanvasOverlayTextbookLabels__textbooklabel___1UQXQ {\\r\\n\\tcolor: #eee;\\r\\n\\tposition: absolute;\\r\\n\\ttext-shadow: black 1px 1px 2px;\\r\\n\\t/*font-weight: bold;*/\\r\\n\\tfont-family: monospace;\\r\\n\\t/*display: block;*/\\r\\n\\r\\n\\t/* the xy position is the top left of the label. I instead center the label around this position */\\r\\n\\twidth: 10em;\\r\\n\\tmargin-left: -5em;\\r\\n\\tmargin-top: -.5em;\\r\\n\\ttext-align: center;\\r\\n}\\r\\n\",\"\"]),t.locals={textbooklabel:\"CanvasOverlayTextbookLabels__textbooklabel___1UQXQ\"}},function(e,t){e.exports=function(e){var t=\"undefined\"!=typeof window&&window.location;if(!t)throw new Error(\"fixUrls requires window.location\");if(!e||\"string\"!=typeof e)return e;var r=t.protocol+\"//\"+t.host,n=r+t.pathname.replace(/\\/[^\\/]*$/,\"/\");return e.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi,function(e,t){var s,i=t.trim().replace(/^\"(.*)\"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(i)?e:(s=0===i.indexOf(\"//\")?i:0===i.indexOf(\"/\")?r+i:n+i.replace(/^\\.\\//,\"\"),\"url(\"+JSON.stringify(s)+\")\")})}},function(e,t,r){(t=e.exports=r(16)(!1)).push([e.i,\".CanvasOverlayButton__btnCanvasOverlay___3UUdK {\\r\\n    color: #ccc;\\r\\n    background-color: #444;\\r\\n    border-color: #666;\\r\\n    opacity: 0.8;\\r\\n}\\r\\n/*.old{\\r\\n\\tcolor: #333333;\\r\\n    background-color: #e7e7e7;\\r\\n    border-color: #cccccc;\\r\\n}*/\\r\\n.CanvasOverlayButton__btnCanvasOverlay___3UUdK:hover {\\r\\n\\tcolor: #ccc;\\r\\n\\tbackground-color: #666;\\r\\n\\tborder-color: #888;\\r\\n    opacity: 0.8;\\r\\n}\\r\\n.CanvasOverlayButton__btnCanvasOverlay___3UUdK:focus {\\r\\n    color: #ccc;\\r\\n    background-color: #666;\\r\\n\\tborder-color: #666;\\r\\n    opacity: 0.8;\\r\\n}\\r\\n.CanvasOverlayButton__btnCanvasOverlay___3UUdK:active {\\r\\n\\tcolor: #ccc;\\r\\n\\tbackground-color: #666;\\r\\n\\tborder-color: #888;\\r\\n    opacity: 0.8;\\r\\n}\\r\\n\\r\\n.CanvasOverlayButton__flash___BWvia {\\r\\n\\tcolor: white;\\r\\n    background-color: #444;\\r\\n    padding: 2px;\\r\\n    opacity: 0.8;\\r\\n\\tborder: 1px solid #666;\\r\\n}\",\"\"]),t.locals={btnCanvasOverlay:\"CanvasOverlayButton__btnCanvasOverlay___3UUdK\",flash:\"CanvasOverlayButton__flash___BWvia\"}},function(e,t,r){\"use strict\";r.r(t);var n=r(1),s=r.n(n),i=r(2),o=r.n(i),a=r(5),l=r.n(a),u=r(6),h=r.n(u),c=r(4),d=r.n(c),f=r(7),m=r.n(f),p=r(3),v=r(18),g=r.n(v),y=r(10),w=r.n(y),x=r(8),b=r.n(x),S=r(0),C=r(19),T=r.n(C),k=r(20),M=r.n(k),_=function(){function e(){s()(this,e)}return o()(e,[{key:\"_getShaderMaterial\",value:function(){return null==this.sm_opaque&&(this.sm_opaque=new S.ShaderMaterial({side:S.DoubleSide,transparent:!1,uniforms:{uVec3AmbientColor:{type:\"v3\",value:new S.Vector3(.2,.2,.2)},uVec3LightingDirection:{type:\"v3\",value:new S.Vector3(-.25,-.25,-1)},uVec3DirectionalColor:{type:\"v3\",value:new S.Vector3(.8,.8,.8)},ubUseLighting:{type:\"1i\",value:1},uVec3Color:{type:\"v3\",value:new S.Vector3(.9,.9,.1)},ufSaturation:{type:\"1f\",value:1}},vertexShader:T.a,fragmentShader:M.a})),this.sm_opaque}},{key:\"getRenderTarget\",value:function(e,t){return null==this.rt_opaque&&(this.rt_opaque=new S.WebGLRenderTarget(e,t,{minFilter:S.LinearFilter,magFilter:S.LinearFilter,format:S.RGBAFormat,stencilBuffer:!1})),this.rt_opaque.width===e&&this.rt_opaque.height===t||this.rt_opaque.setSize(e,t),this.rt_opaque}},{key:\"render\",value:function(e,t,r,n){var s=this._getShaderMaterial();s.setProgramNotYetCalled=!0,t.overrideMaterial=s,e.setRenderTarget(n),e.render(t,r),t.overrideMaterial=null}},{key:\"destroy\",value:function(){null!=this.sm_opaque&&(this.sm_opaque.dispose(),this.sm_opaque=void 0),null!=this.rt_opaque&&(this.rt_opaque.dispose(),this.rt_opaque=void 0)}}]),e}(),D=function(){function e(){s()(this,e)}return o()(e,[{key:\"_getShaderMaterial\",value:function(){return null==this.sm_depthBuffer&&(this.sm_depthBuffer=new S.MeshDepthMaterial({depthTest:!0,depthFunc:S.LessEqualDepth,side:S.DoubleSide})),this.sm_depthBuffer}},{key:\"getRenderTarget\",value:function(e,t){return this.rt_depthBuffer||(this.rt_depthBuffer=new S.WebGLRenderTarget(e,t,{minFilter:S.NearestFilter,magFilter:S.NearestFilter,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!0,depthTexture:new S.DepthTexture,type:S.HalfFloatType}),this.rt_depthBuffer.depthTexture.type=S.UnsignedShortType),this.rt_depthBuffer.width===e&&this.rt_depthBuffer.height===t||this.rt_depthBuffer.setSize(e,t),this.rt_depthBuffer}},{key:\"render\",value:function(e,t,r,n){var s=this._getShaderMaterial();t.overrideMaterial=s,e.setRenderTarget(n),e.render(t,r),t.overrideMaterial=null}},{key:\"destroy\",value:function(){null!=this.sm_depthBuffer&&(this.sm_depthBuffer.dispose(),this.sm_depthBuffer=void 0),null!=this.rt_depthBuffer&&(this.rt_depthBuffer.dispose(),this.rt_depthBuffer=void 0)}}]),e}(),B=function(){function e(){s()(this,e)}return o()(e,[{key:\"_getShaderMaterial\",value:function(){return null!=this.sm_worldPos?this.sm_worldPos:(this.sm_worldPos=new S.ShaderMaterial({transparent:!1,side:S.FrontSide,depthTest:!0,uniforms:{},vertexShader:\"\\nvarying vec3 worldSpaceCoords;\\n\\nvoid main()\\n{\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n\\t//worldSpaceCoords = position; // using worldSpaceCoords instead of volumeSpaceCoords works just fine!\\n\\tworldSpaceCoords = (modelMatrix * vec4( position, 1.0 )).xyz;\\n}\",fragmentShader:\"\\nvarying vec3 worldSpaceCoords;\\n\\nvoid main()\\n{\\n\\t//The fragment's world space coordinates as fragment output.\\n\\tgl_FragColor = vec4( worldSpaceCoords.x , worldSpaceCoords.y, worldSpaceCoords.z, 1.0 );\\n}\"}),this.sm_worldPos)}},{key:\"getRenderTarget\",value:function(e,t,r){return null==this.rt_worldPos&&(this.rt_worldPos=new S.WebGLRenderTarget(e,t,{minFilter:S.LinearFilter,magFilter:S.LinearFilter,wrapS:S.ClampToEdgeWrapping,wrapT:S.ClampToEdgeWrapping,generateMipmaps:!1,stencilBuffer:r,type:S.HalfFloatType,depthBuffer:!0})),this.rt_worldPos.width===e&&this.rt_worldPos.height===t||this.rt_worldPos.setSize(e,t),this.rt_worldPos}},{key:\"renderEntryPoints\",value:function(e,t,r,n,s){var i=this._getShaderMaterial();e.autoClear=!1,i.depthTest=!1,i.side=S.BackSide,e.state.buffers.stencil.setTest(!0),e.state.buffers.stencil.setFunc(e.context.ALWAYS,1,255),e.state.buffers.stencil.setOp(e.context.REPLACE,e.context.REPLACE,e.context.REPLACE),i.depthWrite=!1,i.colorWrite=!1,i.stencil=!0,t.overrideMaterial=i,e.setRenderTarget(s),e.clear(),e.render(t,n),t.overrideMaterial=null,i.side=S.FrontSide,e.state.buffers.stencil.setTest(!0),e.state.buffers.stencil.setFunc(e.context.EQUAL,1,255),e.state.buffers.stencil.setOp(e.context.KEEP,e.context.KEEP,e.context.KEEP),i.depthWrite=!0,i.colorWrite=!0,r.overrideMaterial=i,e.render(r,n),r.overrideMaterial=null,i.stencil=!1,e.state.buffers.stencil.setTest(!1),t.overrideMaterial=i,e.render(t,n),t.overrideMaterial=null,e.autoClear=!0}},{key:\"renderExitPoints\",value:function(e,t,r,n){var s=this._getShaderMaterial();s.depthFunc=S.GreaterEqualDepth,s.side=S.BackSide,e.state.buffers.depth.setClear(0),t.overrideMaterial=s,e.setRenderTarget(n),e.clear(),e.render(t,r),t.overrideMaterial=null,e.state.buffers.depth.setClear(1)}},{key:\"destroy\",value:function(){null!=this.sm_worldPos&&(this.sm_worldPos.dispose(),this.sm_worldPos=void 0),null!=this.rt_worldPos&&(this.rt_worldPos.dispose(),this.rt_worldPos=void 0)}}]),e}(),R=r(21),P=r.n(R),E=r(22),V=r.n(E),L=function(){function e(){s()(this,e)}return o()(e,[{key:\"getRenderTargetPass1\",value:function(e,t){return null==this.rt_pass1&&(this.rt_pass1=new S.WebGLRenderTarget(e,t,{stencilBuffer:!1,type:S.HalfFloatType,depthBuffer:!0,depthTexture:new S.DepthTexture}),this.rt_pass1.depthTexture.type=S.UnsignedShortType),this.rt_pass1.width===e&&this.rt_pass1.height===t||this.rt_pass1.setSize(e,t),this.rt_pass1}},{key:\"getRenderTargetPass2\",value:function(e,t){return null==this.rt_pass2&&(this.rt_pass2=new S.WebGLRenderTarget(e,t,{stencilBuffer:!1,type:S.HalfFloatType,depthBuffer:!1})),this.rt_pass2.width===e&&this.rt_pass2.height===t||this.rt_pass2.setSize(e,t),this.rt_pass2}},{key:\"render1\",value:function(e,t,r,n){null==this.sm_silhouettePass1&&(this.sm_silhouettePass1=new S.MeshDepthMaterial({depthTest:!0,depthFunc:S.LessEqualDepth,side:S.DoubleSide})),t.overrideMaterial=this.sm_silhouettePass1,e.setRenderTarget(n),e.clear(),e.render(t,r),t.overrideMaterial=null}},{key:\"render2\",value:function(e,t,r,n,s){null==this.sm_silhouettePass2&&(this.sm_silhouettePass2=new S.ShaderMaterial({uniforms:{texDepthBuffer:{type:\"t\",value:null},texCustomDepthBuffer:{type:\"t\",value:null},resolution:{type:\"v2\",value:new S.Vector2(1/1024,1/512)},scaleDepthValues:{type:\"f\",value:700},ts:{type:\"f\",value:.045},tc:{type:\"f\",value:.05}},vertexShader:P.a,fragmentShader:V.a}));var i=this.sm_silhouettePass2,o=this.getFullScreenQuad();i.uniforms.texDepthBuffer.value=r,i.uniforms.texCustomDepthBuffer.value=t;var a=e.context.drawingBufferHeight,l=e.context.drawingBufferWidth;i.uniforms.resolution.value=new S.Vector2(1/l,1/a);var u=Math.min(a,l);i.uniforms.scaleDepthValues.value=u,o.overrideMaterial=i,e.setRenderTarget(s),e.render(o,n),o.overrideMaterial=null}},{key:\"getFullScreenQuad\",value:function(){if(null==this.sceneFullScreenQuad){this.sceneFullScreenQuad=new S.Scene;var e=new S.Mesh(new S.PlaneBufferGeometry(2,2),void 0);this.sceneFullScreenQuad.add(e)}return this.sceneFullScreenQuad}},{key:\"destroy\",value:function(){null!=this.sm_silhouettePass1&&(this.sm_silhouettePass1.dispose(),this.sm_silhouettePass1=void 0),null!=this.rt_pass1&&(this.rt_pass1.dispose(),this.rt_pass1=void 0),null!=this.sm_silhouettePass2&&(this.sm_silhouettePass2.dispose(),this.sm_silhouettePass2=void 0),null!=this.rt_pass2&&(this.rt_pass2.dispose(),this.rt_pass2=void 0)}}]),e}(),O=r(23),A=r.n(O),z=r(24),j=r.n(z);A.a,j.a;function U(e){var t=e.children,r=!0,n=!1,s=void 0;try{for(var i,o=t[Symbol.iterator]();!(r=(i=o.next()).done);r=!0){var a=i.value;e.remove(a)}}catch(e){n=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw s}}t=void 0}var N=function(e){var t=parseInt(\"11111111\",2),r=e&t,n=e>>8&t,s=e>>16&t;return new S.Vector3(r/255,n/255,s/255)},F=function(e){switch(e.type){case\"Group\":case\"Scene\":case\"Light\":case\"AmbientLight\":case\"SpotLight\":return!1;case\"Mesh\":case\"Line\":case\"LineSegments\":return!0}throw new Error(\"node type not handled: \"+e.type)},W=function(){function e(){s()(this,e),this.scene=new S.Scene,this.cameraLight=new S.SpotLight(16777215,1.1),this.scene.add(this.cameraLight),this.scene.add(new S.AmbientLight(5592405))}return o()(e,[{key:\"getScene\",value:function(e){switch(e){case\"opaque\":this._setSceneVisibilityOpaque();break;case\"isPickable\":this._setSceneVisibilityPicking();break;case\"contour\":this._setSceneVisibilityOpaque();break;case\"silhouetteAndCreases\":this._setSceneVisibilitySilhouette();break;case\"customMaterial\":this._setSceneVisibilityCustomMaterial();break;default:throw Error(\"RenderStyle \"+e+\" not available.\")}return this.scene}},{key:\"_setSceneVisibilityCustomMaterial\",value:function(){this.scene.traverse(function(e){F(e)&&(e.userData.renderStyles.indexOf(\"customMaterial\")>-1?e.visible=!0:e.visible=!1)})}},{key:\"_setSceneVisibilityOpaque\",value:function(){var e=!1;this.scene.traverse(function(t){F(t)&&t.userData.renderStyles.indexOf(\"desaturate-rest\")>-1&&(e=!0)}),this.scene.traverse(function(t){F(t)&&(t.userData.renderStyles.indexOf(\"opaque\")>-1&&-1==t.userData.renderStyles.indexOf(\"remove-opaque\")?(t.visible=!0,t.userData.saturation=1,e&&-1==t.userData.renderStyles.indexOf(\"saturate-always\")&&(t.userData.saturation=.5)):t.visible=!1)})}},{key:\"_setSceneVisibilitySilhouette\",value:function(){this.scene.traverse(function(e){F(e)&&(e.userData.renderStyles.indexOf(\"silhouetteAndCreases\")>-1?e.visible=!0:e.visible=!1)})}},{key:\"_setSceneVisibilityPicking\",value:function(){}},{key:\"setObjects\",value:function(e){this.scene.children=[this.scene.children[0],this.scene.children[1]];var t=!0,r=!1,n=void 0;try{for(var s,i=e[Symbol.iterator]();!(t=(s=i.next()).done);t=!0){var o=s.value;this._addVisibleObject(o)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:\"_addVisibleObject\",value:function(e){e.children[0].onBeforeRender=function(e,t,r,n,s,i){if(s.setProgramNotYetCalled){var o=s.uniforms;return o.hasOwnProperty(\"ufSaturation\")&&(o.ufSaturation.value=this.userData.saturation),o.hasOwnProperty(\"uVec3Color\")&&(o.uVec3Color.value=this.userData.color),o.hasOwnProperty(\"uVec3MeshID\")&&(o.uVec3MeshID.value=N(this.userData.id)),void(s.setProgramNotYetCalled=!1)}if(s.program&&void 0!==s.uniforms){var a=s.program.getUniforms().renderer.context,l=s.program.getUniforms().map;l.hasOwnProperty(\"ufSaturation\")&&l.ufSaturation.setValue(a,this.userData.saturation),l.hasOwnProperty(\"uVec3Color\")&&l.uVec3Color.setValue(a,this.userData.color),l.hasOwnProperty(\"uVec3MeshID\")&&l.uVec3MeshID.setValue(a,N(this.userData.id))}},this.scene.add(e)}},{key:\"destroy\",value:function(){U(this.scene),window.scene=void 0}}]),e}(),q=function(){function e(){s()(this,e),this.geometrySphereCached={},this.setConnectivityData=this.setConnectivityData.bind(this),this.sceneNetwork=void 0}return o()(e,[{key:\"destroy\",value:function(){U(this.sceneNetwork)}},{key:\"getScene\",value:function(e){if(null==this.sceneNetwork){this.sceneNetwork=new S.Scene;var t=new S.SpotLight(16777215);this.sceneNetwork.add(t)}var r=this.sceneNetwork;return null!=e&&r.children[0].position.set(e.x,e.y,e.z),r}},{key:\"setConnectivityData\",value:function(e,t,r,n){for(var s,i,o=this,a=this.getScene();a.children.length>1;)a.remove(a.children[1]);null!=e&&null!=t&&null!=r&&function(){var l=e,u=t,h=r;if(l.length>0&&u.length>0){for(var c=[],d=0;d<u.length;d++)if(\"null\"!=u[d].CenterNodeCoordinates){var f=u[d].CenterNodeCoordinates.split(\",\"),m=1.33067*u[d].Size/10;null==o.geometrySphereCached[m]&&(o.geometrySphereCached[m]=new S.SphereGeometry(m,32,32)),s=new S.MeshPhongMaterial({color:new S.Color(\"#\"+u[d].Color),shininess:0,specular:new S.Color(\"#000000\")}),(i=new S.Mesh(o.geometrySphereCached[m],s)).position.x=f[0],i.position.y=f[1],i.position.z=f[2],u[d].regionCoordinates=f,c.push(i)}else c.push(void 0);for(var p=function(e){var t=u.find(function(t){return t.Rid===l[e].f}),r=u.find(function(t){return t.Rid===l[e].t});if(null!=t&&null!=r&&t.regionCoordinates!=r.regionCoordinates){var s=t.regionCoordinates,i=r.regionCoordinates,o=1.33067*r.Size/10,c=new S.Color(new S.Color(l[e].lineColor)),d=new S.Vector3(s[0],s[1],s[2]),f=new S.Vector3(i[0],i[1],i[2]),m=new S.Vector3;m.subVectors(f,d);for(var p=m.length(),v=0,g=1,y=0,w=0;w<l.length;w++)l[w].f==l[e].t&&l[e].f==l[w].t&&v++,l[w].t==l[e].t&&l[e].f==l[w].f&&(v++,y++,w<e&&g++);if(v>1){var x=new S.Vector3;x.crossVectors(m,n);var b=.02*g;b-=.02*Math.ceil(y/2),v%2==0&&(b-=.01),d.x=+d.x+x.x*b,d.y=+d.y+x.y*b,d.z=+d.z+x.z*b,f.x=+f.x+x.x*b,f.y=+f.y+x.y*b,f.z=+f.z+x.z*b}if(p>0&&o>0&&p>o)if(h[l[e].cm]){var C=new S.ArrowHelper(m.normalize(),d,p-o,c,p-o<=2?1:2,1.5);a.add(C)}else{var T=new S.LineBasicMaterial({color:c}),k=new S.Geometry;k.vertices.push(new S.Vector3(d.x,d.y,d.z),new S.Vector3(f.x,f.y,f.z));var M=new S.Line(k,T);a.add(M)}}},v=0;v<l.length;v++)p(v);for(var g=0;g<u.length;g++)null!=c[g]&&a.add(c[g])}}()}}]),e}(),H=function(){function e(){s()(this,e),this.setMasks=this.setMasks.bind(this),this.sceneMask=void 0,this.masksUpdated=!1,this.masks=void 0,this.setBrush=this.setBrush.bind(this),this.sceneBrush=void 0,this.brushUpdated=!1,this.brush=void 0}return o()(e,[{key:\"destroy\",value:function(){U(this.sceneBrush),U(this.sceneMask)}},{key:\"setBrush\",value:function(e){null==this.brush&&null==e||null!=this.brush&&null!=e&&JSON.stringify(this.brush)==JSON.stringify(e)||(this.brush=e,this.brushUpdated=!0)}},{key:\"getSceneBrush\",value:function(){if(null==this.sceneBrush&&(this.sceneBrush=new S.Scene),this.brushUpdated){this.brushUpdated=!1,U(this.sceneBrush),this.sceneBrush=new S.Scene;var e=new S.MeshBasicMaterial({color:16776960,opacity:.3,transparent:!0,depthWrite:!1});if(null!=this.brush){var t=this.brush;if(null!=t.radius&&null!=t.path){var r=new S.SphereGeometry(t.radius),n=!0,s=!1,i=void 0;try{for(var o,a=t.path[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var l=o.value,u=!0,h=!1,c=void 0;try{for(var d,f=l[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var m=d.value,p=new S.Mesh(r,e);p.position.x=m[0],p.position.y=m[1],p.position.z=m[2],this.sceneBrush.add(p)}}catch(e){h=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(h)throw c}}}}catch(e){s=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(s)throw i}}}}}return this.sceneBrush}},{key:\"setMasks\",value:function(e){null==this.masks&&null==e||null!=this.masks&&null!=e&&JSON.stringify(this.masks)==JSON.stringify(e)||(this.masks=e,this.masksUpdated=!0)}},{key:\"getMaskScene\",value:function(){var e=this;if(null==this.sceneMask&&(this.sceneMask=new S.Scene),this.masksUpdated){this.masksUpdated=!1,U(this.sceneMask),this.sceneMask=new S.Scene;var t=new S.MeshBasicMaterial({color:16776960,opacity:.3,transparent:!0,depthWrite:!1});if(null!=this.masks){var r=!0,n=!1,s=void 0;try{for(var i,o=function(){var r=i.value,n=0,s=new S.BoxGeometry(r.BoundingBoxScaleX,r.BoundingBoxScaleY,r.BoundingBoxScaleZ),o=new S.BoxGeometry(r.BoundingBoxScaleX,r.BoundingBoxScaleY,r.BoundingBoxScaleZ);if(l=new S.Matrix4,r.hasOwnProperty(\"Data\")){for(var a=atob(r.Data),u=new Uint8Array(a.length),h=0;h<a.length;h++)u[h]=a.charCodeAt(h);for(var c=function(e,t,n){if(e<0||e>r.SizeX)return!1;if(t<0||t>r.SizeY)return!1;if(n<0||n>r.SizeZ)return!1;var s=e+r.SizeX*t+r.SizeX*r.SizeY*n,i=7&s;return(u[s>>3]&1<<i)>0},d=r.StartX*r.BoundingBoxScaleX,f=r.StartY*r.BoundingBoxScaleY,m=r.StartZ*r.BoundingBoxScaleZ,p=0;p<r.SizeZ;p++)for(var v=0;v<r.SizeY;v++)for(var g=0;g<r.SizeX;g++)if(0!=c(g,v,p)&&(0==c(g-1,v,p)||0==c(g+1,v,p)||0==c(g,v+1,p)||0==c(g,v-1,p)||0==c(g,v,p+1)||0==c(g,v,p-1))){var y=d+g*r.BoundingBoxScaleX,w=f+v*r.BoundingBoxScaleY,x=m+p*r.BoundingBoxScaleZ;l.elements=[1,0,0,0,0,1,0,0,0,0,1,0,y,w,x,1],s.merge(o,l),n++}}else if(null!=r.x&&Array.isArray(r.x)){var b=Math.round(r.maxX),C=Math.round(r.maxY),T=Math.round(r.maxZ),k=Math.round(r.minX),M=Math.round(r.minY),_=Math.round(r.minZ);if(null!=r.boundingBoxScaleX&&r.boundingBoxScaleX>1&&r.boundingBoxScaleX,null!=r.boundingBoxScaleY&&r.boundingBoxScaleY>1&&r.boundingBoxScaleY,null!=r.boundingBoxScaleZ&&r.boundingBoxScaleZ>1&&r.boundingBoxScaleZ,b>0&&C>0&&T>0){var D,B,R,P;for(D=Array(b),B=k;B<=b+1;B++)for(D[B]=Array(C),R=M;R<=C+1;R++)for(D[B][R]=Array(T),P=_;P<=T+1;P++)D[B][R][P]=!1;for(var E=0;E<r.x.length;E++){var V=Math.round(r.x[E]),L=Math.round(r.y[E]),O=Math.round(r.z[E]);D[V][L][O]=!0}for(var A=k+1;A<b;A++)for(var z=M+1;z<C;z++)for(var j=_+1;j<T;j++)0!=D[A][z][j]&&(0!=D[A-1][z][j]&&0!=D[A][z-1][j]&&0!=D[A][z][j-1]&&0!=D[A+1][z][j]&&0!=D[A][z+1][j]&&0!=D[A][z][j+1]||(l.elements=[1,0,0,0,0,1,0,0,0,0,1,0,A,z,j,1],s.merge(o,l),n++))}}var U=new S.Mesh(s,t);null!=e.sceneMask&&n>0&&e.sceneMask.add(U)},a=this.masks[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l;o()}}catch(e){n=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw s}}}}return this.sceneMask}}]),e}(),X=r(25),G=r.n(X),I=r(9),Y=r.n(I);S.TrackballControls=r(32);var Q=function(){function e(t,r,n){s()(this,e),this.width=r,this.height=n,this.canvas=t,this.downsamplefactor=.5,this.lastRenderTimeStamp=Date.now(),this.lastRenderTimeStamps=[50,50,50,50,50],this.lastRenderTimeStampsIndex=0,this.onMouseInteraction=this.onMouseInteraction.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.setAppearance=this.setAppearance.bind(this),this.render=this.render.bind(this),this.updateAtlas=this.updateAtlas.bind(this),this.setSize=this.setSize.bind(this),this.defineVolume=this.defineVolume.bind(this),this.setCursor=this.setCursor.bind(this),this.setBrush=this.setBrush.bind(this),this.setMasks=this.setMasks.bind(this),this.hideVolume=this.hideVolume.bind(this),this.destroy=this.destroy.bind(this),this.sceneDownsampledResultPass=void 0,this.sceneBoundingBoxes=void 0,this.sm_volumes=void 0,this.volumeSize=void 0,this.cursor=void 0,this.atlasProcessQueue={working:!1,currentJob:void 0,queue:[]},this.atlasBoundFiles={},this.atlasBoundFiles[0]=void 0,this.atlasBoundFiles[1]=void 0,this.atlasBoundFiles[2]=void 0,this.atlasBoundFiles[3]=void 0,this.traceSteps=256,this.alphaCorrection=1.6,this.renderer=new S.WebGLRenderer({canvas:t,logarithmicDepthBuffer:!1}),this.renderer.setSize(this.width,this.height),this.renderer.setClearColor(0),this.renderer.domElement.onmousemove=this.onMouseInteraction,this.renderer.domElement.onmouseup=this.onMouseUp,this.renderer.domElement.onmousedown=this.onMouseDown,this.renderer.domElement.onwheel=this.onMouseInteraction,this.renderer.domElement.onmouseout=this.onMouseOut,this.RenderPassEntry=new B,this.RenderPassExit=new B,this.RenderPassSilhouette=new L,this.RenderPassOpaqueMesh=new _,this.RenderPassDepthBuffer=new D,this.MeshSceneManager=new W,this.ConnectivityManager=new q,this.BrushAndMaskManager=new H,this.downsampledResultCamera=new S.OrthographicCamera(-1,1,1,-1,-1,1),this.tfData=new Uint8Array(4096),this.tfTex=new S.DataTexture(this.tfData,256,4,S.RGBAFormat,S.UnsignedByteType,S.UVMapping,S.ClampToEdgeWrapping,S.ClampToEdgeWrapping,S.NearestFilter,S.NearestFilter,1)}return o()(e,[{key:\"destroy\",value:function(){U(this.getSceneBoundingBoxes()),U(this.sceneNearPlane),U(this.getSceneDownsampledResultPass()),U(this.getSceneOverlays()),U(this.getSceneVolumes()),null!=this.cameraControls&&this.cameraControls.dispose(),this.MeshSceneManager.destroy(),this.ConnectivityManager.destroy(),this.BrushAndMaskManager.destroy()}},{key:\"defineVolume\",value:function(e,t,r,n,s,i){!(this.atlasWidth==e&&this.atlasHeight==t&&this.atlasColumns==r&&this.atlasRows==n&&this.atlasSliceNum==s&&null!=this.volumeSize&&this.volumeSize.join()==i.join())&&(this.atlasWidth=e,this.atlasHeight=t,this.atlasColumns=r,this.atlasRows=n,this.atlasSliceNum=s,this.volumeSize=i,void 0!==this.sceneBoundingBoxes&&(U(this.sceneBoundingBoxes),this.sceneBoundingBoxes=void 0,this.lineBoxMesh=void 0),this.resetCamera())}},{key:\"setShowBoundingBox\",value:function(e){this.bShowBoundingBox=e}},{key:\"setBackgroundColour\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.backgroundColour=e}},{key:\"setCursor\",value:function(e){this.cursor=e}},{key:\"getSceneBoundingBoxes\",value:function(){if(!this.sceneBoundingBoxes){if(!this.volumeSize)throw new Error(\"renderer.getSceneBoundingBoxes: volumeSize must not be null\");this.sceneBoundingBoxes=new S.Scene;var e=new S.Mesh(function(e){var t=new S.BufferGeometry,r=e,n=new Float32Array([0,0,0,0,0,r[2],0,r[1],0,0,r[1],r[2],r[0],0,0,r[0],0,r[2],r[0],r[1],0,r[0],r[1],r[2]]);t.addAttribute(\"position\",new S.BufferAttribute(n,3));var s=new Uint32Array([0,1,3,0,3,2,1,5,7,1,7,3,4,6,7,4,7,5,0,2,6,0,6,4,2,3,7,2,7,6,0,4,5,0,5,1]);return t.setIndex(new S.BufferAttribute(s,1)),t}(this.volumeSize),void 0);this.sceneBoundingBoxes&&this.sceneBoundingBoxes.add(e)}return this.sceneBoundingBoxes}},{key:\"getSceneNearPlane\",value:function(e){if(null==e)throw new Error(\"renderer.getSceneNearPlane: THREE.Camera is undefined\");if(null==this.sceneNearPlane&&(this.sceneNearPlane=new S.Scene,this.sceneNearPlane.add(new S.Mesh(new S.PlaneGeometry(1,1),void 0))),null==this.sceneNearPlane)throw new Error(\"renderer.getSceneNearPlane: sceneNearPlane is undefined\");if(null==this.sceneNearPlane.children)throw new Error(\"renderer.getSceneNearPlane: sceneNearPlane.children is undefined\");var t=this.sceneNearPlane.children[0];t.position.copy(e.position);var r=new S.Vector3(0,0,-1);return r.applyEuler(e.rotation,e.rotation.order),t.position.add(r.multiplyScalar(1)),t.rotation.copy(e.rotation),e.near=1,this.sceneNearPlane}},{key:\"getAtlasTex\",value:function(){if(null==this.atlasWidth||null==this.atlasHeight)throw new Error(\"renderer.getAtlasTex: atlasWidth or atlasHeight undefined\");if(!this.atlasTex||this.atlasTex.image.width!=this.atlasWidth||this.atlasTex.image.height!=this.atlasHeight){var e=this.atlasWidth*this.atlasHeight*4;(!this.atlasData||this.atlasData.length<e)&&(this.atlasData=new Uint8Array(e)),this.atlasTex&&this.atlasTex.dispose(),this.atlasTex=new S.DataTexture(this.atlasData,this.atlasWidth,this.atlasHeight,S.RGBAFormat,S.UnsignedByteType,S.UVMapping,S.ClampToEdgeWrapping,S.ClampToEdgeWrapping,S.LinearFilter,S.LinearFilter,1)}return this.atlasTex}},{key:\"getSceneVolumes\",value:function(){var e=this.getAtlasTex(),t=this.RenderPassOpaqueMesh.getRenderTarget(this.width,this.height),r=this.RenderPassDepthBuffer.getRenderTarget(this.width,this.height),n=this.RenderPassExit.getRenderTarget(this.width,this.height,!1),s=this.RenderPassEntry.getRenderTarget(this.width,this.height,!0),i=this.RenderPassSilhouette.getRenderTargetPass2(this.width,this.height),o=this.RenderPassSilhouette.getRenderTargetPass1(this.width,this.height);if(e&&n&&s&&this.volumeSize&&this.atlasColumns&&this.atlasRows&&this.tfTex&&this.atlasSliceNum){var a=1/Math.min(this.volumeSize[0],Math.min(this.volumeSize[1],this.volumeSize[2]));if(this.sm_volumes&&this.sceneVolumes||(this.sceneVolumes=new S.Scene,this.sm_volumes=new S.ShaderMaterial({transparent:!1,side:S.FrontSide,depthWrite:!1,depthTest:!1,uniforms:{meshRendererTex:{type:\"t\",value:null},meshRendererDepthTex:{type:\"t\",value:null},backgroundTex:{type:\"t\",value:null},foregroundTex:{type:\"t\",value:null},atlasTex:{type:\"t\",value:null},tfTex:{type:\"t\",value:null},silhouetteTex:{type:\"t\",value:null},silhouetteDepthTex:{type:\"t\",value:null},stepLength:{type:\"1f\",value:null},atlasColumns:{type:\"1i\",value:null},atlasRows:{type:\"1i\",value:null},atlasSliceNum:{type:\"1i\",value:null},volumeSize:{type:\"3f\",value:null},backgroundColour:{type:\"3f\",value:[0,0,0]},viewProjectionInverse:{type:\"m4\",value:null},channel0visible:{type:\"1i\",value:null},channel1visible:{type:\"1i\",value:null},channel2visible:{type:\"1i\",value:null},channel3visible:{type:\"1i\",value:null}},vertexShader:\"\\nvarying vec2 vVec2TextureCoord;\\n\\nvoid main()\\n{\\n\\tvVec2TextureCoord = uv;\\n\\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 ); // render full screen quad only for this shader\\n}\",fragmentShader:G.a}),this.sm_volumes.uniforms.meshRendererTex.value=t.texture,this.sm_volumes.uniforms.meshRendererDepthTex.value=r.depthTexture,this.sm_volumes.uniforms.tfTex.value=this.tfTex,e.needsUpdate=!0,this.tfTex.needsUpdate=!0,this.sm_volumes.uniforms.silhouetteTex.value=i,this.sm_volumes.uniforms.silhouetteDepthTex.value=o.depthTexture,this.meshVolumes=new S.Mesh(new S.PlaneBufferGeometry(2,2),this.sm_volumes),this.meshVolumes.name=\"FullScreen Quad Volumes Scene\",null!=this.sceneVolumes&&this.sceneVolumes.add(this.meshVolumes),this.sm_volumes&&(this.sm_volumes.uniforms.channel0visible.value=!1,this.sm_volumes.uniforms.channel1visible.value=!1,this.sm_volumes.uniforms.channel2visible.value=!1,this.sm_volumes.uniforms.channel3visible.value=!1)),this.sm_volumes){this.sm_volumes.uniforms.volumeSize.value=this.volumeSize;var l=[];if(null!=this.backgroundColour)l=Y()(this.backgroundColour).gl().slice(0,3);3==l.length&&(this.sm_volumes.uniforms.backgroundColour.value=l),this.sm_volumes.uniforms.atlasTex.value!=e&&(this.sm_volumes.uniforms.atlasTex.value=e,this.sm_volumes.uniforms.atlasTex.value.needsUpdate=!0),this.sm_volumes.uniforms.backgroundTex.value=n.texture,this.sm_volumes.uniforms.foregroundTex.value=s.texture,this.sm_volumes.uniforms.atlasColumns.value=this.atlasColumns,this.sm_volumes.uniforms.atlasRows.value=this.atlasRows,this.sm_volumes.uniforms.atlasSliceNum.value=this.atlasSliceNum,this.sm_volumes.uniforms.stepLength.value=a;var u=this.getCamera(),h=new S.Matrix4;return h.multiplyMatrices(u.matrixWorld,h.getInverse(u.projectionMatrix)),this.sm_volumes&&(this.sm_volumes.uniforms.viewProjectionInverse.value=h),this.sceneVolumes.name=\"VolumesScene\",this.sceneVolumes}}}},{key:\"resetCamera\",value:function(){this.getCamera(),this._initCamera(),this.render()}},{key:\"_initCamera\",value:function(){if(null!=this.volumeSize&&null!=this.camera&&null!=this.cameraControls){var e,t,r,n=this.camera,s=this.cameraControls,i=b()(this.volumeSize,3),o=i[0],a=i[1],l=i[2],u=Math.max.apply(Math,w()(this.volumeSize));n.position.set(o/2,a/2,1.3*-u),n.up.x=0,n.up.y=-1,n.up.z=0,s.target=new S.Vector3(o/2,a/2,l/2),s.rotateSpeed=10,s.zoomSpeed=1.5,s.panSpeed=1,s.noZoom=!1,s.noPan=!1,s.staticMoving=!0,s.dynamicDampingFactor=.3,\"Mac OS\"==(e=window.navigator.userAgent,t=window.navigator.platform,r=null,-1!==[\"Macintosh\",\"MacIntel\",\"MacPPC\",\"Mac68K\"].indexOf(t)?r=\"Mac OS\":-1!==[\"iPhone\",\"iPad\",\"iPod\"].indexOf(t)?r=\"iOS\":-1!==[\"Win32\",\"Win64\",\"Windows\",\"WinCE\"].indexOf(t)?r=\"Windows\":/Android/.test(e)?r=\"Android\":!r&&/Linux/.test(t)&&(r=\"Linux\"),r)&&(s.rotateSpeed=3,s.dynamicDampingFactor=5),s.keys=[65,83,68]}}},{key:\"getCamera\",value:function(){if(!this.volumeSize||!this.canvas)throw new Error(\"renderer.getCamera: volumeSize or canvas are undefined\");return null==this.camera?(this.camera=new S.PerspectiveCamera(40,this.width/this.height,1,3*Math.max.apply(Math,w()(this.volumeSize))),this.cameraControls=new S.TrackballControls(this.camera,this.canvas),this.raycaster=new S.Raycaster,this.mouse=new S.Vector2,this._initCamera()):this.camera.aspect!=this.width/this.height&&(this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix()),null!=this.cameraControls&&this.cameraControls.update(),this.camera}},{key:\"getDownsampledResultTargetTexture\",value:function(){if(this.width&&this.height){var e=this.width*this.downsamplefactor,t=this.height*this.downsamplefactor;return this.downsampledResultTargetTexture&&this.downsampledResultTargetTexture.width==e&&this.downsampledResultTargetTexture.height==t||(this.downsampledResultTargetTexture=new S.WebGLRenderTarget(e,t,{minFilter:S.LinearFilter,magFilter:S.LinearFilter,wrapS:S.ClampToEdgeWrapping,wrapT:S.ClampToEdgeWrapping,type:S.UnsignedByteType,generateMipmaps:!1})),this.downsampledResultTargetTexture}}},{key:\"getSceneDownsampledResultPass\",value:function(){var e=this.getDownsampledResultTargetTexture();if(e){if(!this.sceneDownsampledResultPass){this.materialDownsampledResult=new S.MeshBasicMaterial({map:e.texture,depthWrite:!1});var t=new S.Mesh(new S.PlaneGeometry(2,2,1,1),this.materialDownsampledResult);this.sceneDownsampledResultPass=new S.Scene,this.sceneDownsampledResultPass.add(t)}if(null==this.materialDownsampledResult)throw new Error(\"renderer.getSceneDownsampledResultPass: materialDownsampledResult is null\");return this.materialDownsampledResult.map=e.texture,this.sceneDownsampledResultPass}}},{key:\"setConnectivityData\",value:function(e,t,r){if(null!=this.volumeSize&&null!=this.canvas){var n=new S.Vector3;this.getCamera().getWorldDirection(n),this.ConnectivityManager.setConnectivityData(e,t,r,n)}}},{key:\"getLineBoxMesh\",value:function(){if(null==this.volumeSize)throw new Error(\"renderer.getLineBoxMesh: volumeSize must not be undefined\");if(null==this.lineBoxMesh){var e=new S.BufferGeometry,t=this.volumeSize[0],r=this.volumeSize[1],n=this.volumeSize[2],s=new Float32Array([0,0,0,t,0,0,0,0,n,t,0,n,0,r,0,t,r,0,0,r,n,t,r,n,0,0,0,0,r,0,0,0,n,0,r,n,t,0,0,t,r,0,t,0,n,t,r,n,0,0,0,0,0,n,0,r,0,0,r,n,t,0,0,t,0,n,t,r,0,t,r,n]);e.addAttribute(\"position\",new S.BufferAttribute(s,3)),this.lineBoxMesh=new S.LineSegments(e,new S.LineBasicMaterial({color:\"#ffffff\",depthWrite:!1,depthTest:!1}))}if(null==this.lineBoxMesh)throw new Error(\"renderer.getLineBoxMesh: lineBoxMesh is null\");var i=this.lineBoxMesh;void 0!==this.backgroundColour&&(Y()(this.backgroundColour).get(\"hsl.l\")<.5?i.material.color.setHex(16777215):i.material.color.setHex(0));return i}},{key:\"getCursorCrosshairMesh\",value:function(){if(!this.volumeSize)throw new Error(\"renderer.getCursorCrosshairMesh: volumeSize must not be null\");if(!this.cursor)return new S.LineSegments;if(null==this.cursorCrosshairMesh){var e=b()(this.volumeSize,3),t=e[0],r=e[1],n=e[2],s=new S.BufferGeometry,i=new Float32Array([0,0,-n,0,0,n,0,-r,0,0,r,0,-t,0,0,t,0,0]);s.addAttribute(\"position\",new S.BufferAttribute(i,3)),this.cursorCrosshairMesh=new S.LineSegments(s,new S.LineBasicMaterial({linewidth:1,color:\"#ffff00\",depthWrite:!1,depthTest:!1}))}var o=b()(this.cursor,3),a=o[0],l=o[1],u=o[2];return this.cursorCrosshairMesh.position.set(a,l,u),this.cursorCrosshairMesh}},{key:\"determineDownsamplingRate\",value:function(){var e=this.lastRenderTimeStamps.reduce(function(e,t){return e+t});(e/=this.lastRenderTimeStamps.length)<=67&&this.downsamplefactor<1?this.downsamplefactor+=.05:e>67&&this.downsamplefactor>.1&&(this.downsamplefactor-=.05),this.downsamplefactor<.1?this.downsamplefactor=.1:this.downsamplefactor>1&&(this.downsamplefactor=1)}},{key:\"getSceneOverlays\",value:function(){null==this.sceneOverlays&&(this.sceneOverlays=new S.Scene);var e=this.sceneOverlays;if(U(e),this.bShowBoundingBox){var t=this.getLineBoxMesh();void 0!==t&&e.add(t)}var r=this.getCursorCrosshairMesh();return e.add(r),e}},{key:\"setObjects\",value:function(e){this.MeshSceneManager.setObjects(e)}},{key:\"render\",value:function(){var e=Date.now();if(!(e-this.lastRenderTimeStamp<34)&&(this.lastRenderTimeStamp=e,null!=this.volumeSize&&null!=this.canvas)){var t=this.getCamera(),r=this.getSceneNearPlane(t),n=this.getSceneBoundingBoxes(),s=this.getSceneVolumes(),i=this.RenderPassExit.getRenderTarget(this.width,this.height,!1),o=this.RenderPassEntry.getRenderTarget(this.width,this.height,!0),a=this.getSceneOverlays();if(this.renderer.sortObjects=!1,t&&n&&r&&i&&o&&s){this.renderer.setRenderTarget(null),this.RenderPassEntry.renderEntryPoints(this.renderer,n,r,t,o),this.RenderPassExit.renderExitPoints(this.renderer,n,t,i),this.renderer.setRenderTarget(null);var l=this.MeshSceneManager.getScene(\"opaque\");void 0!==this.backgroundColour&&this.renderer.setClearColor(this.backgroundColour);var u=this.RenderPassOpaqueMesh.getRenderTarget(this.width,this.height);this.RenderPassOpaqueMesh.render(this.renderer,l,t,u),this.renderer.setRenderTarget(null),this.renderer.setClearColor(0);var h=this.RenderPassDepthBuffer.getRenderTarget(this.width,this.height);this.RenderPassDepthBuffer.render(this.renderer,l,t,h),this.renderer.setRenderTarget(null);var c=this.MeshSceneManager.getScene(\"silhouetteAndCreases\"),d=this.RenderPassSilhouette.getRenderTargetPass1(this.width,this.height),f=this.RenderPassSilhouette.getRenderTargetPass2(this.width,this.height);if(this.RenderPassSilhouette.render1(this.renderer,c,t,d),this.RenderPassSilhouette.render2(this.renderer,d.texture,d.depthTexture,this.cameraOrtho,f),this.renderer.setRenderTarget(null),this.mousePickingCallback){this.raycaster.setFromCamera(this.mouse,this.camera);var m=this.raycaster.intersectObjects(l.children,!0).map(function(e){return{distance:e.distance,meshIdentifier:e.object.parent.name,point:e.point.toArray()}});this.mousePickingCallback(m)}if(this.cameraOrtho=new S.OrthographicCamera(-1,1,1,-1,0,1),this.allowDownsampling){this.determineDownsamplingRate();var p=this.getSceneDownsampledResultPass(),v=this.getDownsampledResultTargetTexture();v&&p&&(this.renderer.setRenderTarget(v),this.renderer.render(s,this.cameraOrtho),this.renderer.setRenderTarget(null),this.renderer.render(p,this.downsampledResultCamera))}else this.renderer.render(s,this.cameraOrtho);this.renderer.autoClear=!1,this.renderer.render(a,t),this.renderer.autoClear=!0;var g=this.BrushAndMaskManager.getSceneBrush();this.renderer.autoClear=!1,this.renderer.render(g,t),this.renderer.autoClear=!0;var y=this.BrushAndMaskManager.getMaskScene();this.renderer.autoClear=!1,this.renderer.render(y,t),this.renderer.autoClear=!0;var w=t.position,x=this.ConnectivityManager.getScene(w);this.renderer.autoClear=!1,this.renderer.render(x,t),this.renderer.autoClear=!0;var b=this.MeshSceneManager.getScene(\"customMaterial\");this.renderer.autoClear=!1,this.renderer.render(b,t),this.renderer.autoClear=!0;var C=Date.now()-e;this.lastRenderTimeStamps[this.lastRenderTimeStampsIndex++]=C,this.lastRenderTimeStampsIndex>=this.lastRenderTimeStamps.length&&(this.lastRenderTimeStampsIndex=0)}}}},{key:\"setSize\",value:function(e,t){this.width=e,this.height=t,this.renderer.setSize(e,t),null!=this.cameraControls&&(this.cameraControls.screen.height=t),null!=this.cameraControls&&(this.cameraControls.screen.width=e),window.requestAnimationFrame(this.render)}},{key:\"setVolume\",value:function(e,t){if(e<0||e>=4)console.warn(\"Tried to set Volume to not existing channel.\",e);else{var r=this.getAtlasTex();if(r)if(t){if(t.width!=this.atlasWidth||t.height!==this.atlasHeight)return void console.warn(\"Image does not fit to the current atlas dimensions.\",t.width,t.height);this.atlasProcessQueue.queue.push({type:\"SET_VOLUME\",img:t,channel:e,step:0,stepNum:100}),this.atlasBoundFiles[e]={image:t.src,visible:!0},window.setTimeout(this.updateAtlas,0)}else{for(var n=0;n<this.atlasWidth*this.atlasHeight*4;n+=4)this.atlasData[n+e]=0;this.atlasBoundFiles[e]=void 0,r.needsUpdate=!0}}}},{key:\"setTransferFunction\",value:function(e,t){if(e<0||e>=4)console.warn(\"Tried to set transfer function into not existing channel\",e);else if(1024===t.length){for(var r=256*e*4,n=0;n<1024;n++)this.tfData[n+r]=t[n];this.tfTex.needsUpdate=!0}else console.warn(\"transfer function must be of length 256*4\")}},{key:\"setAppearance\",value:function(e,t,r,n,s,i){if(i){var o=256*e*4,a=127-127/r-n,l=127+128/r-n;a<0?a=0:a>255&&(a=255),l<1?l=1:l>256&&(l=256);for(var u=Y.a.scale([\"#000\",t,\"#efefef\"]).domain([0,.2,.8,1]).mode(\"lrgb\"),h=0;h<256;h++){var c=(h-a)/(l-a);c<0?c=0:c>1&&(c=1);var d=u(c).rgb();this.tfData[o+4*h+0]=d[0],this.tfData[o+4*h+1]=d[1],this.tfData[o+4*h+2]=d[2],this.tfData[o+4*h+3]=c*(1-s)*255}null!=this.sm_volumes&&(this.sm_volumes.uniforms[\"channel\"+e+\"visible\"].value=1)}else this.hideVolume(e);this.tfTex.needsUpdate=!0}},{key:\"setBrush\",value:function(e){this.BrushAndMaskManager.setBrush(e)}},{key:\"setMasks\",value:function(e){this.BrushAndMaskManager.setMasks(e)}},{key:\"setMousePickingCallback\",value:function(e){this.mousePickingCallback=e}},{key:\"hideVolume\",value:function(e){for(var t=256*e*4,r=t+1024,n=t;n<r;n++)this.tfData[n]=0;this.sm_volumes&&(this.sm_volumes.uniforms[\"channel\"+e+\"visible\"].value=0),this.tfTex.needsUpdate=!0,this.atlasBoundFiles[e]&&(this.atlasBoundFiles[e].visible=!1),window.requestAnimationFrame(this.render)}},{key:\"onMouseInteraction\",value:function(e){e&&e.preventDefault(),this.mousePickingCallback&&(void 0===this.mouse?console.log(\"Mouse undefined\"):(this.mouse.x=e.offsetX/this.width*2-1,this.mouse.y=-e.offsetY/this.height*2+1)),window.requestAnimationFrame(this.render)}},{key:\"onMouseDown\",value:function(e){e&&e.preventDefault(),this.allowDownsampling=!0,this.lastRenderTimeStamp=Date.now(),window.requestAnimationFrame(this.render)}},{key:\"onMouseUp\",value:function(e){e&&e.preventDefault(),this.allowDownsampling=!1,window.requestAnimationFrame(this.render)}},{key:\"onMouseOut\",value:function(e){e&&e.preventDefault(),this.allowDownsampling=!1,window.requestAnimationFrame(this.render)}},{key:\"updateAtlas\",value:function(){if(this.imageDataCanvas||(this.imageDataCanvas=document.createElement(\"canvas\")),this.atlasProcessQueue.currentJob){var e=this.atlasProcessQueue.currentJob;this.atlasBoundFiles[e.channel]&&this.atlasBoundFiles[e.channel].image==e.img.src||(delete this.atlasProcessQueue.currentJob,window.setTimeout(this.updateAtlas,0));var t=this.imageDataCanvas.getContext(\"2d\"),r=Math.floor(e.img.height/e.stepNum),n=r;if(e.step==e.stepNum-1){var s=e.step*n;n=e.img.height-s}this.imageDataCanvas&&(this.imageDataCanvas.width=e.img.width,this.imageDataCanvas.height=n),t.drawImage(e.img,0,-e.step*r);for(var i=t.getImageData(0,0,e.img.width,n),o=e.step*r*e.img.width*4,a=0;a<n*e.img.width*4;a+=4)this.atlasData[a+Number(e.channel)+o]=i.data[a];e.step++,e.step===e.stepNum&&(this.atlasProcessQueue.currentJob=void 0),this.getAtlasTex().needsUpdate=!0,e.step%10==0&&window.requestAnimationFrame(this.render),window.setTimeout(this.updateAtlas,0)}else if(this.atlasProcessQueue.queue.length>0){var l=g()(this.atlasProcessQueue.queue),u=l[0],h=l.slice(1);this.atlasProcessQueue.currentJob=u,this.atlasProcessQueue.queue=h,this.atlasProcessQueue.working=!0,window.setTimeout(this.updateAtlas,0)}else this.atlasProcessQueue.working=!1}}]),e}();var Z=r(11),K=r.n(Z),J=function(e){function t(e){var r;return s()(this,t),(r=l()(this,h()(t).call(this,e))).handleChange=r.handleChange.bind(d()(r)),r.registerEventListener=r.registerEventListener.bind(d()(r)),r.state={hasEventListener:!1,cameraControls:void 0},r}return m()(t,e),o()(t,[{key:\"handleChange\",value:function(){var e=this;this.forceUpdate(),null!=this.delayedUpdate&&clearTimeout(this.delayedUpdate),this.delayedUpdate=setTimeout(function(){e.forceUpdate()},400)}},{key:\"shouldComponentUpdate\",value:function(e){var t=this;return this.props.width===e.width&&this.props.height===e.height||(null!=this.delayedUpdate&&clearTimeout(this.delayedUpdate),this.delayedUpdate=setTimeout(function(){t.forceUpdate()},30),!1)}},{key:\"componentWillUnmount\",value:function(){null!=this.delayedUpdate&&clearTimeout(this.delayedUpdate),this.state.cameraControls&&this.state.cameraControls.removeEventListener(\"change\",this.handleChange),this.setState({hasEventListener:!1,cameraControls:void 0})}},{key:\"registerEventListener\",value:function(){var e=this.props.renderer;!this.state.hasEventListener&&e&&e.camera&&e.cameraControls&&(e.cameraControls.addEventListener(\"change\",this.handleChange),this.setState({hasEventListener:!0,cameraControls:e.cameraControls}))}},{key:\"componentDidMount\",value:function(){this.registerEventListener()}},{key:\"componentDidUpdate\",value:function(){this.registerEventListener()}},{key:\"getMeshLabels\",value:function(e,t,r,n){return!t||t.length<1||!t[0].children[0].geometry.boundingSphere?p.createElement(\"div\",null):t.map(function(t,s){if(!t.children[0].geometry.boundingSphere)return p.createElement(\"span\",{key:s});var i=t.children[0].geometry.boundingSphere.center.clone(),o=t.children[0].userData.txtLabel;return i.project(e),i.x=i.x*r+r,i.y=-i.y*n+n,i.z=0,p.createElement(\"span\",{key:\"m\"+s,style:{top:i.y,left:i.x},className:K.a.textbooklabel},o)})}},{key:\"getNetworkRegionLabels\",value:function(e,t,r,n){return!t||t.length<1?p.createElement(\"div\",null):t.map(function(t,s){if(!t.CenterNodeCoordinates)return p.createElement(\"span\",{key:s});var i=t.CenterNodeCoordinates.split(\",\"),o=new S.Vector3(i[0],i[1],i[2]),a=t.ShortName;return o.project(e),o.x=o.x*r+r,o.y=-o.y*n+n,o.z=0,p.createElement(\"span\",{key:\"r\"+s,style:{top:o.y,left:o.x},className:K.a.textbooklabel},a)})}},{key:\"render\",value:function(){var e=this.props,t=e.renderer,r=e.meshes,n=e.regions,s=e.width,i=e.height;if(!t||!t.camera)return p.createElement(\"div\",null);var o=s/2,a=i/2,l=this.getMeshLabels(t.camera,r,o,a),u=this.getNetworkRegionLabels(t.camera,n,o,a);return p.createElement(\"div\",{style:{pointerEvents:\"none\",position:\"absolute\",width:s,height:i,overflow:\"hidden\"}},l,u)}}]),t}(p.Component),$=r(12),ee=r.n($);r.d(t,\"default\",function(){return te});var te=function(e){function t(e){var r;return s()(this,t),(r=l()(this,h()(t).call(this,e))).renderList={maxSlots:4},r.renderList[0]=void 0,r.renderList[1]=void 0,r.renderList[2]=void 0,r.renderList[3]=void 0,r.doesRenderURL=r.doesRenderURL.bind(d()(r)),r.freeRenderSlot=r.freeRenderSlot.bind(d()(r)),r.resetCamera=r.resetCamera.bind(d()(r)),r.rendererID=null!=e.rendererID?e.rendererID:Math.random().toString(36).substring(7),r.state={flashWarn:void 0},r}return m()(t,e),o()(t,[{key:\"render\",value:function(){var e,t,r=this;if(this.state.flashWarn&&(e=p.createElement(\"div\",{className:ee.a.flash},this.state.flashWarn)),this.props.showTextbookLabels&&null!=this.renderer){var n=null==this.props.connectivityRegions?[]:this.props.connectivityRegions;t=p.createElement(J,{renderer:this.renderer,meshes:this.props.meshes,regions:n,width:this.props.width,height:this.props.height})}return p.createElement(\"div\",null,t,p.createElement(\"div\",{style:{position:\"absolute\",padding:\"2px\"}},p.createElement(\"button\",{type:\"button\",className:\"btn \"+ee.a.btnCanvasOverlay,onClick:this.resetCamera},p.createElement(\"span\",{className:\"glyphicon glyphicon-home\",\"aria-hidden\":\"true\"})),e),p.createElement(\"canvas\",{ref:function(e){r.canvas=e}}))}},{key:\"componentDidMount\",value:function(){this.initRenderer(),this.renderer&&this.renderer.render(),this.renderer&&this.renderer.setSize(this.props.width,this.props.height)}},{key:\"componentDidUpdate\",value:function(){this.updateRendererProps(this.props),this.renderer&&this.renderer.setSize(this.props.width,this.props.height),this.renderer&&this.renderer.render()}},{key:\"initRenderer\",value:function(){this.canvas&&(null==window.renderers&&(window.renderers={}),null!=window.renderers&&null!=window.renderers[this.rendererID]?this.renderer=window.renderers[this.rendererID]:(this.renderer=new Q(this.canvas,this.props.width,this.props.height),window.renderers[this.rendererID]=this.renderer)),this.updateRendererProps(this.props)}},{key:\"doesRenderURL\",value:function(e){for(var t=0;t<this.renderList.maxSlots;t++){var r=this.renderList[t];if(null!=r&&r.url===e)return t}return-1}},{key:\"freeRenderSlot\",value:function(){for(var e=0;e<this.renderList.maxSlots;e++)if(null==this.renderList[e])return e;return-1}},{key:\"resetCamera\",value:function(){this.renderer&&this.renderer.resetCamera()}},{key:\"updateRenderList\",value:function(e,t,r,n,s,i){var o=this;if(e&&t&&r&&n&&s&&i){for(var a=0;a<this.renderList.maxSlots;a++)if(this.renderList[a]){var l=e.indexOf(this.renderList[a].url);-1!=l&&i[l]||(this.renderer&&this.renderer.hideVolume(a),this.renderer&&this.renderer.setVolume(a,void 0),this.renderList[a]=void 0)}for(var u=function(a){var l=e[a],u=t[a],h=r[a],c=n[a],d=s[a],f=i[a];if(!f)return\"continue\";var m=o.doesRenderURL(l),p=o.renderList[m];if(null!=p)u==p.color&&h==p.contrast&&c==p.brightness&&d==p.transparency&&f==p.visible||(p.contrast=h,p.brightness=c,p.transparency=d,p.visible=f,o.renderer&&o.renderer.setAppearance(m,u,h,c,d,f));else{var v=o.freeRenderSlot();if(v>=0){o.renderList[v]={url:l,color:u,contrast:h,brightness:c,transparency:d,visible:f};var g=new Image;g.onload=function(){o.renderer&&o.renderer.setVolume(v,g),o.renderer&&o.renderer.setAppearance(v,u,h,c,d,f)},g.src=l}else o.setState({flashWarn:\"Only four images can be rendered at the same time!\"}),o.flashTimeout&&clearTimeout(o.flashTimeout),o.flashTimeout=setTimeout(function(){return o.setState({flashWarn:void 0})},1e4)}},h=0;h<e.length;h++)u(h)}else console.error(\"MultiVolumeRenderView updateRenderList value missing\")}},{key:\"updateRendererProps\",value:function(e){if(this.renderer&&e.atlasSize&&e.atlasGrid&&e.sliceNum&&e.volumeSize&&this.renderer.defineVolume(e.atlasSize.width,e.atlasSize.height,e.atlasGrid[0],e.atlasGrid[1],e.sliceNum,e.volumeSize),this.updateRenderList(e.imageURLs,e.colors,e.contrasts,e.brightnesses,e.transparencies,e.visibilities),this.renderer){var t=this.renderer;t.setObjects(e.meshes),t.setCursor(e.cursor),t.setShowBoundingBox(e.showBoundingBox),t.setBackgroundColour(e.backgroundColour),t.setMousePickingCallback(e.mousePickingCallback),t.setBrush(e.brush),t.setMasks(e.masks),t.setConnectivityData(e.connectivityConnections,e.connectivityRegions,e.connectivityIsDirected)}}}]),t}(p.Component);te.defaultProps={showTextbookLabels:!1,backgroundColour:0}}])});","extractedComments":[]}